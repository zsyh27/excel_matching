# DDC 设备清单匹配报价系统 - 项目总览

> 快速了解项目的所有信息

---

## 🎯 项目简介

DDC 设备清单匹配报价系统是一个轻量化的 Web 应用，专为 DDC 自控领域的设备清单报价流程设计。系统通过**设备行智能识别**和**智能匹配算法**，自动识别 Excel 设备清单中的设备行并匹配设备信息，生成标准化的报价单。

**核心价值**: 将传统需要数小时的人工报价流程缩短至几分钟，准确率从人工的 80-90% 提升至 98%+。

---

## 📊 核心功能与指标

### 功能 1: 设备行智能识别与手动调整 ✅

**功能描述**: 自动识别 Excel 文件中哪些行是真正的设备行，过滤掉表头、合计、备注等无关行。

**技术方案**: 三维度加权评分模型
- 数据类型组合分析（权重 30%）
- 结构关联性分析（权重 35%）
- 行业通用特征分析（权重 35%）

**性能指标**:
- ✅ 自动识别准确率: **98.04%** (目标 ≥95%)
- ✅ 手动调整后准确率: **100%** (目标 100%)
- ✅ 识别速度: <1 秒/66 行
- ✅ 单元测试: 76 个全部通过

**用户体验**:
- 5 种颜色编码（高/中/低概率、手动标记/取消）
- 单行调整 + 批量调整
- 多维度筛选（行号、内容、概率等级）

### 功能 2: 设备智能匹配与报价导出 ✅

**功能描述**: 将识别出的设备行与设备库进行智能匹配，生成包含单价的报价清单。

**技术方案**: 特征权重匹配算法
- 三层归一化处理
- 特征权重累加
- 阈值判定

**性能指标**:
- ✅ 匹配准确率: **91.30%** (目标 ≥85%)
- ✅ 解析速度: 0.032 秒/29 行
- ✅ 匹配速度: 0.008 秒/100 个
- ✅ 格式保留: 100% 保留原 Excel 格式

---

## 🏗️ 技术架构

### 技术栈

**后端**:
- Python 3.8+ / Flask
- openpyxl (xlsx/xlsm)
- xlrd (xls)
- pytest + hypothesis (测试)

**前端**:
- Vue 3
- Element Plus
- Axios
- Vite

**数据存储**:
- 静态 JSON 文件（无数据库依赖）

### 项目结构

```
ddc-device-matching/
├── backend/                    # 后端（Python/Flask）
│   ├── app.py                 # API 入口
│   ├── modules/               # 核心模块
│   │   ├── device_row_classifier.py  # 设备行分类器 ⭐
│   │   ├── excel_parser.py           # Excel 解析
│   │   ├── text_preprocessor.py      # 文本预处理
│   │   ├── match_engine.py           # 匹配引擎
│   │   ├── excel_exporter.py         # Excel 导出
│   │   └── data_loader.py            # 数据加载
│   └── tests/                 # 76 个单元测试
├── frontend/                   # 前端（Vue 3）
│   └── src/
│       ├── components/
│       │   └── DeviceRowAdjustment.vue  # 设备行调整组件 ⭐
│       └── views/
│           ├── FileUploadView.vue
│           ├── DeviceRowAdjustmentView.vue  # 设备行调整页面 ⭐
│           └── MatchingView.vue
├── data/                       # 数据文件
│   ├── static_device.json     # 25 个设备
│   ├── static_rule.json       # 25 条规则
│   └── static_config.json     # 配置（含设备行识别配置）
└── .kiro/specs/               # 规格文档
    ├── ddc-device-matching/   # 设备匹配功能规格
    └── device-row-intelligent-recognition/  # 设备行识别功能规格 ⭐
```

---

## 🚀 快速开始

### 1. 环境要求
- Python 3.8+
- Node.js 16+
- npm 或 yarn

### 2. 安装依赖

**后端**:
```bash
cd backend
python -m venv venv
venv\Scripts\activate  # Windows
pip install -r requirements.txt
```

**前端**:
```bash
cd frontend
npm install
```

### 3. 启动服务

**后端**:
```bash
cd backend
python app.py
# 运行在 http://localhost:5000
```

**前端**:
```bash
cd frontend
npm run dev
# 运行在 http://localhost:5173
```

### 4. 访问应用
打开浏览器访问: `http://localhost:5173`

---

## 📖 完整工作流程

```
┌─────────────────────────────────────────────────────────────┐
│  1. 用户上传 Excel 文件                                       │
│     支持格式: .xls, .xlsx, .xlsm                             │
└─────────────────────────────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────────┐
│  2. 系统自动识别设备行（三维度评分）                          │
│     • 数据类型组合分析                                        │
│     • 结构关联性分析                                          │
│     • 行业通用特征分析                                        │
│     → 准确率: 98.04%                                         │
└─────────────────────────────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────────┐
│  3. 前端展示分析结果（颜色编码）                              │
│     🔵 高概率（浅蓝色）: 50 行                                │
│     🟡 中概率（浅黄色）: 2 行                                 │
│     ⚪ 低概率（浅灰色）: 14 行                                │
└─────────────────────────────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────────┐
│  4. 用户手动调整（可选）                                      │
│     • 单行调整: 下拉选择                                      │
│     • 批量调整: 复选框 + 批量操作                            │
│     • 多维度筛选: 快速定位                                    │
│     → 调整 1 行后准确率: 100%                                │
└─────────────────────────────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────────┐
│  5. 获取最终设备行列表                                        │
│     • 手动调整优先                                            │
│     • 自动判断补充                                            │
│     → 最终设备行: 51 行                                      │
└─────────────────────────────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────────┐
│  6. 设备智能匹配                                              │
│     • 特征权重匹配算法                                        │
│     • 匹配准确率: 91.30%                                     │
│     • 支持手动调整                                            │
└─────────────────────────────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────────┐
│  7. 导出报价清单                                              │
│     • 仅包含最终设备行                                        │
│     • 包含匹配的设备信息和单价                                │
│     • 保留原始 Excel 格式                                    │
└─────────────────────────────────────────────────────────────┘
```

---

## 📚 文档索引

### 快速入门
- 📖 **README.md** - 项目说明和使用指南
- 🚀 **QUICK_START_GUIDE.md** - 快速启动指南
- ⚙️ **SETUP.md** - 详细安装指南
- 🔧 **MAINTENANCE.md** - 数据维护指南

### 功能文档

**设备行智能识别功能**:
- 📋 **DEVICE_ROW_RECOGNITION_FINAL_SUMMARY.md** - 功能完整总结
- ✅ **TASK_9_FINAL_CHECKPOINT_REPORT.md** - 最终检查点报告
- 📝 `.kiro/specs/device-row-intelligent-recognition/requirements.md` - 需求文档（15 个需求）
- 🎨 `.kiro/specs/device-row-intelligent-recognition/design.md` - 设计文档（三维度评分模型）
- ✔️ `.kiro/specs/device-row-intelligent-recognition/tasks.md` - 任务清单（9 个任务，已完成）

**设备匹配功能**:
- 📝 `.kiro/specs/ddc-device-matching/requirements.md` - 需求文档（9 个需求）
- 🎨 `.kiro/specs/ddc-device-matching/design.md` - 设计文档
- ✔️ `.kiro/specs/ddc-device-matching/tasks.md` - 任务清单（13 个任务）

### 实施总结文档

**设备行识别**:
- `backend/TASK2_COMPLETION_SUMMARY.md` - 三维度评分算法
- `backend/TASK3_API_IMPLEMENTATION_SUMMARY.md` - API 接口实现
- `backend/TASK5_ACCURACY_VERIFICATION_SUMMARY.md` - 准确率验证
- `backend/E2E_TEST_REPORT.md` - 端到端测试报告
- `frontend/TASK_6_COMPLETION_SUMMARY.md` - 前端组件实现
- `frontend/TASK_7_INTEGRATION_SUMMARY.md` - 前端集成

**设备匹配**:
- `TASK_12_COMPLETION_SUMMARY.md` - 任务 12 完成总结
- `FINAL_ACCEPTANCE_REPORT.md` - 最终验收报告

### 项目管理
- 📋 **.kiro/PROJECT.md** - 项目概述和规划
- 📄 **PROJECT_OVERVIEW.md** - 本文件（项目总览）

---

## 🧪 测试与验证

### 测试覆盖

**单元测试**: 76 个测试全部通过 ✅
```bash
cd backend
pytest tests/ -v
```

**设备行识别测试**:
```bash
python backend/test_device_row_recognition.py
```
- 自动识别准确率: 98.04%
- 手动调整后准确率: 100%

**设备匹配测试**:
```bash
python backend/check_real_accuracy.py
```
- 匹配准确率: 91.30%

### 测试文件

**真实场景测试文件**:
- `data/(原始表格)建筑设备监控及能源管理报价清单(2).xlsx`
- 总行数: 66 行
- 真实设备行: 第 6-21 行、第 23-57 行（共 51 行）
- 包含: 表头、合计、备注等无关行

**示例文件**:
- `data/示例设备清单.xlsx`
- 标准格式示例，适合快速测试

---

## ⚙️ 配置说明

所有配置都在 `data/static_config.json` 文件中：

### 设备行识别配置

```json
"device_row_recognition": {
  "scoring_weights": {
    "data_type": 0.30,    // 数据类型组合权重
    "structure": 0.35,    // 结构关联性权重
    "industry": 0.35      // 行业特征权重
  },
  "probability_thresholds": {
    "high": 70.0,         // 高概率阈值（≥70 分）
    "medium": 40.0        // 中概率阈值（40-69 分）
  },
  "industry_keywords": {
    "device_types": [     // 设备类型词库
      "传感器", "控制器", "DDC", "阀门", "执行器", ...
    ],
    "parameters": [       // 参数词库
      "PPM", "℃", "Pa", "%RH", "m/s", "MPa", "mA", ...
    ],
    "brands": [           // 品牌词库
      "霍尼韦尔", "西门子", "江森自控", "施耐德", ...
    ],
    "model_patterns": [   // 型号模式（正则表达式）
      "[A-Z]{2,}-[A-Z0-9]+", "[A-Z]+\\d{3,}", ...
    ]
  }
}
```

### 设备匹配配置

```json
{
  "normalization_map": {  // 字符归一化映射
    "～": "-",
    "℃": "摄氏度",
    ...
  },
  "feature_split_chars": [",", "，", ";", "；", ...],
  "ignore_keywords": ["施工要求", "验收", ...],
  "default_match_threshold": 2.0
}
```

---

## 🎨 用户界面

### 页面 1: 文件上传
- 拖拽或点击上传 Excel 文件
- 支持 .xls, .xlsx, .xlsm 格式
- 文件大小限制: 10MB

### 页面 2: 设备行调整 ⭐
- **概率等级视觉展示**:
  - 🔵 浅蓝色: 高概率设备行（≥70 分）
  - 🟡 浅黄色: 中概率可疑行（40-69 分）
  - ⚪ 浅灰色: 低概率无关行（<40 分）
  - 🟢 深绿色: 手动标记为设备行
  - 🔴 深红色: 手动取消设备行

- **操作功能**:
  - 单行调整（下拉选择）
  - 批量调整（复选框 + 批量操作按钮）
  - 多维度筛选（行号、内容、概率等级）
  - 显示得分和判定依据

### 页面 3: 设备匹配
- 显示匹配结果表格
- 统计信息（总数、成功、失败、准确率）
- 支持手动选择设备
- 导出报价清单按钮

---

## 📈 性能指标总览

| 指标 | 目标 | 实际达成 | 状态 |
|------|------|----------|------|
| 设备行识别准确率 | ≥95% | **98.04%** | ✅ 超额完成 |
| 手动调整后准确率 | 100% | **100%** | ✅ 完美达成 |
| 设备匹配准确率 | ≥85% | **91.30%** | ✅ 超额完成 |
| Excel 解析速度 | ≤5 秒 | **0.032 秒** | ✅ 远超预期 |
| 设备匹配速度 | ≤10 秒 | **0.008 秒** | ✅ 远超预期 |
| 识别速度 | ≤2 秒 | **<1 秒** | ✅ 远超预期 |
| 单元测试通过率 | 100% | **100%** (76/76) | ✅ 全部通过 |

---

## 🔄 版本历史

### v1.1.0 (2026-02-08) - 当前版本 ⭐
**新增设备行智能识别功能**
- ✅ 三维度加权评分模型
- ✅ 自动识别准确率 98.04%
- ✅ 手动调整功能（单行 + 批量）
- ✅ 多维度筛选功能
- ✅ 5 种颜色编码视觉反馈
- ✅ 完整的前后端实现
- ✅ 76 个单元测试全部通过
- ✅ 完整的文档和使用指南

### v1.0.0 (2024-02)
**核心功能实现**
- ✅ Excel 多格式支持
- ✅ 智能匹配算法
- ✅ 格式保留导出
- ✅ 完整的测试套件
- ✅ 示例数据和文档

---

## 🛠️ 开发指南

### 代码规范
- Python 代码遵循 PEP 8 规范
- Vue 代码遵循 Vue 3 组合式 API 规范
- 使用类型注解提高代码可读性
- 所有公共方法需要添加文档字符串

### 测试要求
- 单元测试覆盖率目标: ≥80%
- 所有新功能必须有对应的测试
- 提交前必须确保所有测试通过

### Git 工作流
1. Fork 本仓库
2. 创建特性分支 (`git checkout -b feature/AmazingFeature`)
3. 提交更改 (`git commit -m 'Add some AmazingFeature'`)
4. 推送到分支 (`git push origin feature/AmazingFeature`)
5. 开启 Pull Request

---

## 🐛 故障排查

### 常见问题

**Q1: 上传文件失败**
- 检查文件格式是否为 xls/xlsm/xlsx
- 检查文件大小是否超过 10MB
- 检查文件是否损坏

**Q2: 识别准确率低**
- 检查 Excel 文件格式是否规范
- 调整配置文件中的评分权重
- 扩充行业词库

**Q3: 匹配准确率低**
- 检查设备描述是否包含足够的特征信息
- 调整规则表中的特征权重
- 添加更多归一化映射到配置文件

**Q4: 导出文件格式错误**
- 检查原文件是否包含合并单元格
- 检查原文件是否有特殊格式
- 查看后端日志获取详细错误信息

更多故障排查信息请参考 `MAINTENANCE.md`。

---

## 📞 联系与支持

### 获取帮助
- 📖 查看文档: 本目录下的各种 .md 文件
- 🐛 提交 Issue: 在 GitHub 上提交问题
- 💬 讨论交流: 联系开发团队

### 贡献指南
欢迎贡献代码、文档或提出建议！请查看上面的 Git 工作流部分。

---

## 📄 许可证

MIT License

Copyright (c) 2026 DDC Device Matching System

---

## 🎉 致谢

感谢所有为本项目做出贡献的开发者和用户！

---

**最后更新**: 2026-02-08  
**当前版本**: v1.1.0  
**项目状态**: ✅ 生产就绪
