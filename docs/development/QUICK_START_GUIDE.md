# 快速启动指南 - DDC 设备清单匹配报价系统

## 📋 项目概述

DDC 设备清单匹配报价系统是一个完整的 Web 应用，包含两大核心功能：

### 🎯 核心功能

1. **设备行智能识别与手动调整** ✅
   - 三维度加权评分模型（数据类型、结构关联、行业特征）
   - 自动识别准确率: **98.04%**
   - 手动调整后准确率: **100%**
   - 5 种颜色编码视觉反馈
   - 支持单行和批量调整
   - 多维度筛选功能

2. **设备智能匹配与报价导出** ✅
   - 特征权重匹配算法
   - 匹配准确率: **91.30%**
   - 完美保留 Excel 格式
   - 支持手动调整匹配结果

### 📊 性能指标

- ✅ 设备行识别: <1 秒/66 行
- ✅ Excel 解析: 0.032 秒/29 行
- ✅ 设备匹配: 0.008 秒/100 个
- ✅ 单元测试: 76 个全部通过

---

## 系统概述

本系统实现了从 Excel 文件上传、设备行智能识别、手动调整到设备匹配的完整工作流程。

## 启动步骤

### 1. 启动后端服务

```bash
cd backend
python app.py
```

**预期输出**:
```
 * Running on http://127.0.0.1:5000
```

### 2. 启动前端开发服务器

```bash
cd frontend
npm run dev
```

**预期输出**:
```
  VITE v5.x.x  ready in xxx ms

  ➜  Local:   http://localhost:5173/
  ➜  Network: use --host to expose
```

### 3. 访问应用

在浏览器中打开: `http://localhost:5173/`

## 完整工作流程

### 步骤 1: 上传 Excel 文件

1. 访问首页（文件上传页面）
2. 拖拽或点击上传一个 Excel 文件
3. 等待上传和分析完成
4. 系统会自动跳转到设备行调整页面

**支持的文件格式**: .xls, .xlsx, .xlsm  
**文件大小限制**: 10MB

### 步骤 2: 查看和调整设备行识别结果

在设备行调整页面，你会看到：

#### 概率等级标注
- 🔵 **浅蓝色**: 高概率设备行（≥70分）
- 🟡 **浅黄色**: 中概率可疑行（40-69分）
- ⚪ **浅灰色**: 低概率无关行（<40分）

#### 手动调整操作
1. **单行调整**: 使用每行右侧的下拉框
   - 标记为设备行
   - 取消设备行
   - 恢复自动判断

2. **批量调整**: 
   - 勾选多行
   - 点击"批量标记为设备行"或"批量取消设备行"

3. **筛选功能**:
   - 按行号搜索
   - 按内容关键词搜索
   - 按概率等级筛选

### 步骤 3: 确认并进入匹配

1. 完成调整后，点击"确认调整并进入匹配"按钮
2. 系统会获取最终设备行列表
3. 自动跳转到匹配页面

### 步骤 4: 查看匹配结果

在匹配页面，你会看到：

#### 统计信息
- 总设备数
- 匹配成功数量
- 匹配失败数量
- 匹配准确率

#### 匹配结果表格
- 每个设备行的匹配结果
- 匹配成功的显示设备信息和单价
- 匹配失败的可以手动选择设备

#### 操作选项
- **返回调整**: 返回设备行调整页面继续修改
- **导出报价清单**: 导出包含匹配结果的 Excel 文件

### 步骤 5: 导出报价清单

1. 在匹配页面点击"导出报价清单"按钮
2. 系统会生成包含匹配结果的 Excel 文件
3. 文件会自动下载到本地

**导出文件特点**:
- 仅包含最终确认的设备行
- 包含匹配的设备信息和单价
- 保留原始 Excel 的格式

## 测试文件

系统提供了测试文件用于验证功能：

```
data/(原始表格)建筑设备监控及能源管理报价清单(2).xlsx
```

**文件特点**:
- 真实设备行: 第 6-21 行、第 23-57 行（共 51 行）
- 包含表头、合计等无关行
- 适合测试自动识别准确率

**预期结果**:
- 自动识别准确率: ≥95%
- 手动调整后准确率: 100%

## 常见问题

### Q1: 上传后没有跳转到调整页面？
**A**: 检查浏览器控制台是否有错误，确认后端服务正常运行。

### Q2: 调整页面显示"未找到分析结果"？
**A**: 这可能是因为：
- 页面刷新导致 sessionStorage 数据丢失
- 解决方法: 重新上传文件

### Q3: 匹配页面无数据？
**A**: 确保从调整页面点击"确认调整并进入匹配"按钮进入，而不是直接访问 URL。

### Q4: 导出的 Excel 文件为空？
**A**: 确保至少有一个设备行被标记为设备行（自动或手动）。

## 技术架构

### 前端技术栈
- Vue 3 - 渐进式 JavaScript 框架
- Vue Router 4 - 官方路由管理器
- Element Plus - UI 组件库
- Vite - 构建工具

### 后端技术栈
- Python 3.8+
- Flask - Web 框架
- openpyxl - Excel 处理库

### 数据流转
```
上传文件
  ↓
后端分析 (/api/excel/analyze)
  ↓
保存到 sessionStorage
  ↓
调整页面加载数据
  ↓
手动调整 (/api/excel/manual-adjust)
  ↓
获取最终设备行 (/api/excel/final-device-rows)
  ↓
设备匹配 (/api/match)
  ↓
导出 Excel (/api/export)
```

## 开发调试

### 查看 sessionStorage 数据

在浏览器控制台执行：
```javascript
// 查看所有 sessionStorage 数据
console.log(sessionStorage)

// 查看特定 excel_id 的数据
const excelId = 'your-excel-id'
const data = JSON.parse(sessionStorage.getItem(`analysis_${excelId}`))
console.log(data)
```

### 查看路由状态

在浏览器控制台执行：
```javascript
// 查看当前路由
console.log(window.location.pathname)

// 查看路由状态
console.log(history.state)
```

### 清除缓存数据

在浏览器控制台执行：
```javascript
// 清除所有 sessionStorage
sessionStorage.clear()
```

## 性能优化建议

### 前端优化
1. 使用动态导入减少首屏加载时间
2. 启用 Gzip 压缩
3. 使用 CDN 加速静态资源

### 后端优化
1. 添加 Redis 缓存分析结果
2. 使用异步任务处理大文件
3. 实现分页加载大量设备行

## 部署指南

### 前端部署

```bash
cd frontend
npm run build
```

构建产物在 `frontend/dist` 目录，可以部署到：
- Nginx
- Apache
- Vercel
- Netlify

### 后端部署

使用 Gunicorn 部署：
```bash
cd backend
gunicorn -w 4 -b 0.0.0.0:5000 app:app
```

## 联系支持

如有问题，请查看：
- 📖 详细文档: `TASK_7_FINAL_REPORT.md`
- 🧪 测试指南: `frontend/test-integration-flow.md`
- 📝 实施总结: `frontend/TASK_7_INTEGRATION_SUMMARY.md`

---

**版本**: 1.0.0  
**最后更新**: 2026-02-08
