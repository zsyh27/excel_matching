# 处理分隔符配置指南

## 快速理解

在配置管理页面的"处理分隔符"部分，您只需要记住一个核心概念：

**第一个分隔符是"标准分隔符"，常见分隔符会自动转换为它。**

## 工作原理

### 1. 标准分隔符（第一个分隔符）

当前配置：`+`

**作用**：
- 在智能清理阶段，系统会自动将以下常见分隔符转换为标准分隔符：
  - 逗号：`,` 和 `，`（中英文逗号）
  - 空格：` `（单个或多个空格）
  - 制表符：`\t`

**示例**：
```
输入：室内CO2传感器, 485传输, 量程0-2000ppm
      ↓ 智能清理（分隔符统一）
输出：室内CO2传感器+485传输+量程0-2000ppm
```

### 2. 其他分隔符

**作用**：
- 用于特征提取时的文本拆分
- 如果您的设备描述使用了特殊分隔符，可以添加到列表中

**示例**：
如果您的设备描述是这样的：
```
室内CO2传感器 | 485传输 | 量程0-2000ppm
```

您可以添加 `|` 到分隔符列表中，系统会按 `|` 拆分文本。

## 配置建议

### 推荐配置（默认）

```json
{
  "feature_split_chars": ["+"]
}
```

**说明**：
- 只保留一个标准分隔符 `+`
- 常见分隔符（逗号、空格等）会自动转换为 `+`
- 大多数情况下，这个配置已经足够

### 特殊场景配置

如果您的设备描述使用了特殊分隔符，可以添加：

```json
{
  "feature_split_chars": ["+", "|", "/"]
}
```

**注意**：
- 第一个分隔符 `+` 仍然是标准分隔符
- 其他分隔符 `|` 和 `/` 用于特征提取时的拆分

## 常见问题

### Q1: 为什么我的文本中的逗号变成了加号？

**A**: 这是正常的预处理行为。

- 在智能清理阶段，系统会自动将常见分隔符统一为标准分隔符
- 这样做的目的是统一文本格式，便于后续的特征提取和匹配
- 您可以在匹配详情页面的"智能清理"部分看到这个转换过程

### Q2: 我需要在配置中添加逗号和空格吗？

**A**: 不需要。

- 逗号、空格、制表符等常见分隔符会自动处理
- 您只需要保留默认的 `+` 作为标准分隔符即可
- 手动添加这些分隔符不会有任何效果

### Q3: 什么时候需要添加其他分隔符？

**A**: 只有在以下情况下才需要添加：

1. 您的设备描述使用了特殊分隔符（如 `|`、`/`、`;` 等）
2. 这些特殊分隔符在您的业务场景中有特定含义
3. 您希望系统按这些分隔符拆分文本

**示例场景**：
```
设备描述：霍尼韦尔 | T7350 | 室内温度传感器
```
在这种情况下，您可以添加 `|` 到分隔符列表中。

### Q4: 如何验证分隔符统一是否生效？

**A**: 在匹配详情页面查看：

1. 打开任意匹配结果的详情页面
2. 切换到"特征提取"标签
3. 查看"智能清理"部分
4. 如果"应用的规则"中包含"分隔符统一"标签，说明已生效
5. 在"文本对比"中可以看到转换前后的文本

### Q5: 设备库数据会执行分隔符统一吗？

**A**: 不会。

- 设备库数据使用 `device` 模式，保持原始格式
- 只有匹配数据（`matching` 模式）才会执行分隔符统一
- 这样设计是为了保持设备库数据的完整性

## 配置界面说明

在配置管理页面的"处理分隔符"编辑器中，您会看到：

### 1. 配置说明面板（蓝色提示框）

包含以下信息：
- 标准分隔符的定义和作用
- 自动转换的常见分隔符列表
- 其他分隔符的用途
- 配置建议

### 2. 分隔符列表

显示当前配置的所有分隔符：
- 第一个分隔符是标准分隔符（高亮显示）
- 每个分隔符显示其 Unicode 编码
- 可以添加或删除分隔符

### 3. 统计信息

显示当前配置的分隔符总数

## 最佳实践

### 1. 保持简单

- 大多数情况下，只需要一个标准分隔符 `+`
- 不要添加过多分隔符，这可能导致特征过度拆分

### 2. 理解自动转换

- 常见分隔符（逗号、空格等）会自动转换
- 不需要手动配置这些分隔符

### 3. 测试验证

- 修改配置后，重新生成规则并匹配
- 在匹配详情页面查看处理效果
- 确认特征提取结果符合预期

### 4. 文档记录

- 如果添加了特殊分隔符，记录添加原因
- 便于团队成员理解配置意图

## 技术细节

### 处理流程

```
1. 原始文本
   "室内CO2传感器, 485传输, 量程0-2000ppm"
   
2. 智能清理（分隔符统一）
   "室内CO2传感器+485传输+量程0-2000ppm"
   
3. 删除无关关键词
   "室内CO2传感器+485传输+量程0-2000ppm"
   
4. 归一化
   "室内co2传感器+485传输+量程0-2000ppm"
   
5. 特征提取（按+拆分）
   ["室内co2传感器", "485传输", "量程0-2000ppm"]
```

### 代码实现

在 `backend/modules/text_preprocessor.py` 中：

```python
# 阶段4: 统一分隔符
if mode == 'matching' and self.feature_split_chars:
    temp_separator = self.feature_split_chars[0]  # 标准分隔符
    for sep in [',', '，', ' ', '  ', '\t']:
        text = text.replace(sep, temp_separator)
```

### 配置文件

在 `data/static_config.json` 中：

```json
{
  "feature_split_chars": ["+"]
}
```

## 总结

**核心要点**：
1. 第一个分隔符是标准分隔符（当前是 `+`）
2. 常见分隔符会自动转换为标准分隔符
3. 大多数情况下，默认配置已经足够
4. 只有使用特殊分隔符时才需要添加配置

**配置原则**：
- 保持简单
- 理解自动转换
- 测试验证
- 文档记录

通过这个配置指南，您应该能够轻松理解和配置"处理分隔符"功能。如有疑问，请参考匹配详情页面的实际处理效果。
