# 规则管理界面用户手册

## 目录

- [简介](#简介)
- [访问规则管理界面](#访问规则管理界面)
- [规则列表视图](#规则列表视图)
- [规则详情与编辑](#规则详情与编辑)
- [匹配测试工具](#匹配测试工具)
- [匹配日志查看](#匹配日志查看)
- [批量操作](#批量操作)
- [统计分析](#统计分析)
- [常见问题](#常见问题)

## 简介

规则管理界面是 DDC 设备清单匹配报价系统的核心功能模块，用于可视化地查看、调整和优化设备匹配规则。通过规则管理界面，您可以：

- 查看所有设备的匹配规则
- 调整特征权重和匹配阈值
- 实时测试匹配效果
- 查看历史匹配记录
- 批量优化规则配置
- 分析匹配统计数据

**适用人群**: 系统管理员、数据维护人员、技术支持人员

**前置条件**: 
- 系统必须使用数据库模式（JSON 文件模式不支持规则管理功能）
- 需要管理员权限

## 访问规则管理界面

1. 启动后端服务和前端应用
2. 在浏览器中打开 `http://localhost:5173`
3. 在主界面导航栏点击"规则管理"
4. 进入规则管理系统主界面

## 规则列表视图

### 功能概述

规则列表视图展示所有设备的匹配规则概览，支持搜索、筛选和分页。

### 界面元素

```
┌─────────────────────────────────────────────────────────────┐
│ 规则管理系统                                                 │
├─────────────────────────────────────────────────────────────┤
│ 搜索: [_______________] [搜索]                               │
│ 筛选: 品牌[全部▼] 设备类型[全部▼] 阈值[全部▼]               │
├─────────────────────────────────────────────────────────────┤
│ 设备ID    │ 品牌    │ 设备名称    │ 型号    │ 阈值 │ 操作   │
├─────────────────────────────────────────────────────────────┤
│ SENSOR001 │ 霍尼韦尔 │ 温度传感器  │ HST-RA  │ 5.0  │ [详情] │
│ SENSOR002 │ 西门子  │ 压力传感器  │ QBE2003 │ 5.0  │ [详情] │
│ ...       │ ...     │ ...         │ ...     │ ...  │ ...    │
└─────────────────────────────────────────────────────────────┘
│ 第 1 页，共 36 页                                [上一页][下一页]│
└─────────────────────────────────────────────────────────────┘
```

### 使用方法

#### 1. 搜索规则

在搜索框中输入关键词，支持搜索：
- 设备ID（如 "SENSOR001"）
- 品牌名称（如 "霍尼韦尔"）
- 设备名称（如 "温度传感器"）
- 规格型号（如 "HST-RA"）

**示例**: 搜索 "温度传感器"，系统会显示所有包含该关键词的规则。

#### 2. 筛选规则

使用筛选器缩小结果范围：

**按品牌筛选**:
- 选择品牌下拉框
- 选择特定品牌（如 "霍尼韦尔"）
- 系统显示该品牌的所有规则

**按设备类型筛选**:
- 选择设备类型下拉框
- 选择特定类型（如 "传感器"）
- 系统显示该类型的所有规则

**按阈值范围筛选**:
- 选择阈值范围（如 "3.0-5.0"）
- 系统显示阈值在该范围内的规则

#### 3. 查看规则详情

点击规则行的"详情"按钮，进入规则详情与编辑视图。

### 快捷操作

- **批量选择**: 勾选多个规则，可以进行批量操作
- **排序**: 点击列标题可以按该列排序
- **刷新**: 点击刷新按钮重新加载规则列表

## 规则详情与编辑

### 功能概述

规则详情视图显示单个设备的完整匹配规则，包括所有特征及其权重，支持实时编辑。

### 界面布局

```
┌─────────────────────────────────────────────────────────────┐
│ 设备信息                                                     │
│ 品牌: 霍尼韦尔  名称: 温度传感器  型号: HST-RA               │
│ 规则ID: R_SENSOR001  匹配阈值: [5.0] [保存]                 │
├─────────────────────────────────────────────────────────────┤
│ 特征与权重配置                                               │
│ ┌─────────────────────────────────────────────────────────┐ │
│ │ 特征              │ 权重  │ 类型     │ 操作             │ │
│ ├─────────────────────────────────────────────────────────┤ │
│ │ 温度传感器        │ [5.0] │ 设备类型 │ [编辑] [删除]    │ │
│ │ 霍尼韦尔          │ [3.0] │ 品牌     │ [编辑] [删除]    │ │
│ │ HST-RA            │ [3.0] │ 型号     │ [编辑] [删除]    │ │
│ │ 4-20ma            │ [1.0] │ 参数     │ [编辑] [删除]    │ │
│ │ 0-10v             │ [1.0] │ 参数     │ [编辑] [删除]    │ │
│ └─────────────────────────────────────────────────────────┘ │
│ [添加新特征] [批量调整] [重置为默认] [保存所有更改]          │
├─────────────────────────────────────────────────────────────┤
│ 权重分布图表                                                 │
│ [柱状图显示各特征权重分布]                                   │
└─────────────────────────────────────────────────────────────┘
```

### 使用方法

#### 1. 修改匹配阈值

1. 在"匹配阈值"输入框中输入新的阈值（建议 5.0-10.0）
2. 点击"保存"按钮
3. 系统自动更新规则并重新加载

**建议阈值**:
- 传感器: 5.0-7.0
- 控制器: 7.0-10.0
- 阀门/执行器: 5.0-7.0
- 控制柜: 7.0-10.0

#### 2. 修改特征权重

**方式 1: 单个修改**
1. 点击特征行的"编辑"按钮
2. 在弹出的对话框中输入新的权重值
3. 点击"确定"保存

**方式 2: 批量修改**
1. 勾选多个特征
2. 点击"批量调整"按钮
3. 输入新的权重值
4. 点击"应用"

**权重建议**:
- 设备类型: 5.0-10.0（最重要）
- 品牌: 3.0
- 型号: 3.0
- 参数: 1.0-2.0
- 可选特征: 0.5-1.0

#### 3. 添加新特征

1. 点击"添加新特征"按钮
2. 输入特征名称（使用归一化后的格式）
3. 选择特征类型（品牌/设备类型/型号/参数）
4. 输入权重值
5. 点击"添加"

**注意**: 添加的特征应该使用归一化后的格式（小写、无空格），例如：
- ✅ "4-20ma"
- ❌ "4~20mA"

#### 4. 删除特征

1. 点击特征行的"删除"按钮
2. 确认删除操作
3. 系统自动更新规则

**警告**: 删除核心特征（如设备类型、品牌、型号）可能导致匹配失败。

#### 5. 重置规则

点击"重置为默认"按钮，将规则恢复到自动生成的初始状态。

**注意**: 此操作会丢失所有手动调整，请谨慎使用。

### 权重分布图表

图表显示当前规则的权重分布，帮助您直观地了解权重配置：
- X轴: 特征名称
- Y轴: 权重值
- 颜色: 按特征类型区分

## 匹配测试工具

### 功能概述

匹配测试工具用于实时测试设备描述的匹配效果，查看详细的匹配过程和候选规则得分。

### 界面布局

```
┌─────────────────────────────────────────────────────────────┐
│ 测试输入                                                     │
│ ┌─────────────────────────────────────────────────────────┐ │
│ │ 温度传感器，0-50℃，4-20mA                                │ │
│ └─────────────────────────────────────────────────────────┘ │
│ [开始测试] [清空] [使用示例]                                 │
├─────────────────────────────────────────────────────────────┤
│ 预处理结果                                                   │
│ 原始文本: 温度传感器，0-50℃，4-20mA                          │
│ 归一化后: 温度传感器,0-50,4-20ma                             │
│ 提取特征: ['温度传感器', '0-50', '4-20ma']                   │
├─────────────────────────────────────────────────────────────┤
│ 候选规则得分 (前10个)                                        │
│ ┌─────────────────────────────────────────────────────────┐ │
│ │ 排名 │ 设备名称          │ 得分 │ 阈值 │ 匹配特征        │ │
│ ├─────────────────────────────────────────────────────────┤ │
│ │ 1 ✓  │ 温度传感器 HST-RA │ 9.0  │ 5.0  │ 温度传感器(5.0) │ │
│ │      │                   │      │      │ 霍尼韦尔(3.0)   │ │
│ │      │                   │      │      │ 4-20ma(1.0)     │ │
│ │ 2    │ 湿度传感器        │ 4.0  │ 5.0  │ 4-20ma(1.0)     │ │
│ │ 3    │ 压力传感器        │ 4.0  │ 5.0  │ 4-20ma(1.0)     │ │
│ └─────────────────────────────────────────────────────────┘ │
├─────────────────────────────────────────────────────────────┤
│ 最终匹配结果                                                 │
│ ✓ 匹配成功                                                   │
│ 设备: 霍尼韦尔 温度传感器 HST-RA                              │
│ 得分: 9.0 (超过阈值 5.0)                                     │
│ 匹配原因: 温度传感器(5.0) + 霍尼韦尔(3.0) + 4-20ma(1.0)     │
└─────────────────────────────────────────────────────────────┘
```

### 使用方法

#### 1. 输入测试描述

在测试输入框中输入设备描述，例如：
- "温度传感器，0-50℃，4-20mA"
- "DDC控制器，8点输入，8点输出"
- "电动调节阀，DN50，0-10V"

#### 2. 开始测试

点击"开始测试"按钮，系统会：
1. 预处理输入文本（归一化、特征提取）
2. 计算所有规则的得分
3. 显示前10个候选规则
4. 高亮显示最终匹配结果

#### 3. 查看预处理结果

预处理结果显示：
- **原始文本**: 您输入的原始描述
- **归一化后**: 应用归一化映射后的文本
- **提取特征**: 拆分后的特征列表

**用途**: 检查特征提取是否正确，是否需要添加新的归一化映射。

#### 4. 分析候选规则得分

候选规则列表显示前10个得分最高的规则，包括：
- **排名**: 按得分降序排列
- **设备名称**: 候选设备的完整名称
- **得分**: 权重累计得分
- **阈值**: 该规则的匹配阈值
- **匹配特征**: 匹配到的特征及其权重
- **✓ 标记**: 表示该规则达到阈值，匹配成功

**用途**: 
- 如果错误的规则得分更高，说明权重配置有问题
- 如果正确的规则得分不够，说明需要提高权重或降低阈值

#### 5. 查看最终匹配结果

最终匹配结果显示：
- **匹配状态**: 成功或失败
- **匹配设备**: 最终选中的设备
- **得分**: 最高得分
- **匹配原因**: 详细的得分计算过程

### 使用场景

**场景 1: 诊断匹配问题**
1. 输入问题描述
2. 查看候选规则得分列表
3. 分析为什么错误的规则得分更高
4. 调整权重或阈值
5. 重新测试验证效果

**场景 2: 验证规则调整**
1. 调整规则后，使用测试工具验证
2. 输入多个测试用例
3. 确认调整后的效果
4. 如果效果不理想，继续调整

## 匹配日志查看

### 功能概述

匹配日志记录所有历史匹配操作，支持按时间、状态、设备类型筛选和导出。

### 界面布局

```
┌─────────────────────────────────────────────────────────────┐
│ 匹配日志                                                     │
├─────────────────────────────────────────────────────────────┤
│ 时间范围: [2026-02-01] 到 [2026-02-14]                      │
│ 状态: [全部▼] 设备类型: [全部▼] [查询] [导出]               │
├─────────────────────────────────────────────────────────────┤
│ 时间        │ 输入描述        │ 状态 │ 匹配设备    │ 得分  │ │
├─────────────────────────────────────────────────────────────┤
│ 10:30:15    │ 温度传感器...   │ 成功 │ HST-RA      │ 9.0   │ │
│ 10:31:22    │ 压力传感器...   │ 失败 │ -           │ 2.5   │ │
│ ...         │ ...             │ ...  │ ...         │ ...   │ │
└─────────────────────────────────────────────────────────────┘
│ 第 1 页，共 31 页                                [上一页][下一页]│
└─────────────────────────────────────────────────────────────┘
```

### 使用方法

#### 1. 按时间范围筛选

1. 选择开始日期和结束日期
2. 点击"查询"按钮
3. 系统显示该时间范围内的所有日志

#### 2. 按匹配状态筛选

选择状态下拉框：
- **全部**: 显示所有日志
- **成功**: 只显示匹配成功的日志
- **失败**: 只显示匹配失败的日志

**用途**: 快速定位匹配失败的案例，分析失败原因。

#### 3. 按设备类型筛选

选择设备类型下拉框（如 "传感器"、"控制器"），系统显示该类型的所有日志。

#### 4. 查看日志详情

点击日志行，查看详细信息：
- 完整的输入描述
- 提取的特征列表
- 候选规则得分
- 匹配原因

#### 5. 导出日志

点击"导出"按钮，选择导出格式：
- **CSV**: 适合用 Excel 打开
- **Excel**: 包含格式和图表

导出的文件包含所有筛选后的日志记录。

### 使用场景

**场景 1: 分析匹配失败原因**
1. 筛选失败的日志
2. 查看失败案例的输入描述
3. 使用匹配测试工具重新测试
4. 分析失败原因并调整规则

**场景 2: 监控匹配准确率**
1. 按时间范围查询日志
2. 统计成功和失败的数量
3. 计算准确率
4. 如果准确率下降，及时调整规则

## 批量操作

### 功能概述

批量操作用于一次性调整多个规则的权重或阈值，提高优化效率。

### 操作类型

#### 1. 按特征类型批量调整权重

**场景**: 降低所有通用参数的权重

**步骤**:
1. 点击"批量操作"按钮
2. 选择"按特征类型调整权重"
3. 选择特征类型（如 "参数"）
4. 输入新的权重值（如 1.0）
5. 选择应用范围（全部规则或选中的规则）
6. 点击"应用"

**效果**: 所有规则中的参数类型特征权重都会更新为 1.0。

#### 2. 批量调整阈值

**场景**: 提高所有规则的匹配阈值

**步骤**:
1. 点击"批量操作"按钮
2. 选择"批量调整阈值"
3. 输入新的阈值（如 5.0）
4. 选择应用范围
5. 点击"应用"

**效果**: 所有选中规则的匹配阈值都会更新为 5.0。

#### 3. 批量重置规则

**场景**: 将某些规则恢复到初始状态

**步骤**:
1. 在规则列表中勾选需要重置的规则
2. 点击"批量操作"按钮
3. 选择"批量重置规则"
4. 确认操作
5. 点击"应用"

**警告**: 此操作会丢失所有手动调整，请谨慎使用。

### 注意事项

- 批量操作会逐个处理规则，部分失败不影响其他规则
- 操作完成后会显示成功和失败的数量
- 建议先在少量规则上测试，确认效果后再批量应用
- 重要操作前建议创建版本备份

## 统计分析

### 功能概述

统计分析提供可视化的权重分布、阈值分布和匹配准确率趋势图表。

### 图表类型

#### 1. 权重分布直方图

显示所有特征的权重分布：
- X轴: 权重值范围（0-1, 1-2, 2-3, 3-4, 4-5, 5+）
- Y轴: 特征数量
- 颜色: 按特征类型区分

**用途**: 识别权重配置是否合理，是否存在权重过高或过低的问题。

#### 2. 阈值分布饼图

显示不同阈值的规则占比：
- 扇区: 不同的阈值（2.0, 5.0, 7.0, 10.0）
- 大小: 该阈值的规则数量占比

**用途**: 识别阈值配置是否过于集中，是否需要差异化设置。

#### 3. 匹配准确率趋势图

显示匹配准确率随时间的变化：
- X轴: 时间（按天或周）
- Y轴: 准确率（0-100%）
- 折线: 准确率变化趋势

**用途**: 监控规则调整后的效果，评估优化是否有效。

### 使用方法

1. 点击"统计分析"标签
2. 查看各类图表
3. 点击图表元素查看详细数据
4. 导出图表为图片或 PDF

### 使用场景

**场景 1: 识别权重配置问题**
1. 查看权重分布直方图
2. 如果发现大量特征权重在 3.0 以上，说明权重过高
3. 使用批量操作降低通用参数权重

**场景 2: 评估优化效果**
1. 调整规则前记录当前准确率
2. 调整规则后查看准确率趋势图
3. 如果准确率上升，说明优化有效
4. 如果准确率下降，考虑回滚

## 常见问题

### Q1: 为什么修改规则后没有生效？

**A**: 检查以下几点：
1. 是否点击了"保存"按钮
2. 是否收到成功提示
3. 刷新页面重新查看
4. 检查后端日志是否有错误

### Q2: 如何判断权重设置是否合理？

**A**: 参考以下原则：
1. 设备类型权重应该最高（5.0-10.0）
2. 品牌和型号权重次之（3.0）
3. 通用参数权重最低（1.0）
4. 使用匹配测试工具验证效果

### Q3: 批量操作失败怎么办？

**A**: 
1. 查看错误提示，了解失败原因
2. 检查是否有规则被锁定
3. 尝试减少批量操作的规则数量
4. 联系技术支持

### Q4: 如何恢复误操作？

**A**: 
1. 如果刚刚操作，使用浏览器的"撤销"功能
2. 如果已经保存，使用"重置规则"功能
3. 如果有版本备份，回滚到之前的版本
4. 如果都不行，联系技术支持恢复数据库备份

### Q5: 匹配测试工具和实际匹配结果不一致？

**A**: 
1. 确认规则是否已保存
2. 确认是否重新加载了规则
3. 检查配置文件是否有变化
4. 清除浏览器缓存重试

### Q6: 如何提高匹配准确率？

**A**: 
1. 使用匹配日志分析失败案例
2. 识别高频误匹配特征
3. 降低通用参数权重
4. 提高设备类型关键词权重
5. 提高匹配阈值
6. 使用批量测试验证效果

### Q7: 规则管理界面加载很慢？

**A**: 
1. 检查网络连接
2. 检查数据库性能
3. 减少每页显示的规则数量
4. 使用筛选功能缩小结果范围
5. 联系技术支持优化数据库

### Q8: 如何导出规则配置？

**A**: 
1. 使用版本管理功能导出当前版本
2. 或使用数据库导出工具
3. 导出格式为 JSON
4. 可以在其他环境导入

## 联系支持

如遇到无法解决的问题，请联系技术支持：

- 📧 邮箱: support@example.com
- 📞 电话: 400-xxx-xxxx
- 💬 在线支持: https://support.example.com

提供以下信息以便快速定位问题：
1. 错误截图或日志
2. 操作步骤
3. 系统版本信息
4. 规则ID（如涉及）

---

**文档版本**: v1.0.0  
**最后更新**: 2026-02-14  
**维护者**: DDC 系统开发团队
