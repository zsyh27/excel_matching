# 特征权重配置说明

## 概念区分

### 1. 配置中的特征权重 (feature_weight_config)

**位置**: 配置管理 > 高级配置 > 特征权重配置

**作用**: 
- 这是规则生成的**模板**或**默认值**
- 用于告诉规则生成器:"当你生成新规则时,给不同类型的特征分配什么权重"

**配置项**:
```json
{
  "feature_weight_config": {
    "brand_weight": 1.0,        // 品牌特征的默认权重
    "model_weight": 1.0,        // 型号特征的默认权重
    "device_type_weight": 4.0,  // 设备类型特征的默认权重
    "parameter_weight": 4.0     // 参数特征的默认权重
  }
}
```

**何时使用**:
- 仅在**生成新规则**时使用
- 通过"重新生成规则"按钮触发
- 或者添加新设备时自动生成规则

### 2. 规则中的特征权重

**位置**: 规则编辑器 > 特征与权重配置

**作用**:
- 这是**已保存规则**中每个特征的实际权重
- 用于实际的设备匹配计算

**示例**:
```
规则ID: R_V5011N1040_U000000000000000001
特征列表:
  - 霍尼韦尔: 1.0 (品牌)
  - 座阀: 2.5 (设备类型)
  - dn15: 1.0 (参数)
  - 水: 4.0 (参数)
```

**特点**:
- 一旦规则生成并保存,权重就固定了
- 不会因为配置改变而自动更新
- 可以在规则编辑器中手动修改

## 为什么"dn15"的权重是1而不是4?

### 原因

这个规则是在你修改配置**之前**生成的。

**时间线**:
1. 初始配置: `parameter_weight = 1.0`
2. 生成规则: "dn15"被分配权重 1.0
3. 规则保存到数据库
4. 你修改配置: `parameter_weight = 4.0`
5. 查看规则: "dn15"仍然是 1.0 (因为规则已经保存)

### 类比

想象配置是一个"饼干模具",规则是"烤好的饼干":

- **配置 (模具)**: 你可以随时更换模具的形状
- **规则 (饼干)**: 一旦烤好,形状就固定了
- **重新生成规则 (重新烤)**: 用新模具重新烤一批饼干

## 如何应用新的权重配置?

### 方法1: 重新生成所有规则 (推荐)

**步骤**:
1. 在配置管理页面修改特征权重配置
2. 点击"保存配置"
3. 点击"重新生成规则"按钮
4. 等待所有719个设备的规则重新生成(约3-5秒)

**效果**:
- 所有规则都会使用新的权重配置
- 所有"参数"类型的特征权重都会变成4.0
- 所有"设备类型"特征权重都会变成4.0
- 所有"品牌"和"型号"特征权重都会变成1.0

**优点**:
- 一次性更新所有规则
- 确保所有规则使用相同的权重策略
- 自动化,无需手动操作

**缺点**:
- 会覆盖所有手动修改的权重
- 如果某些规则有特殊调整,会丢失

### 方法2: 手动修改单个规则

**步骤**:
1. 打开规则编辑器页面
2. 找到要修改的特征(如"dn15")
3. 修改权重值(从1.0改为4.0)
4. 点击"保存修改"

**效果**:
- 只修改这一个规则
- 其他规则不受影响

**优点**:
- 精确控制
- 不影响其他规则
- 可以为特定规则设置特殊权重

**缺点**:
- 需要逐个修改
- 如果有很多规则需要修改,工作量大

### 方法3: 批量调整 (在规则编辑器中)

**步骤**:
1. 打开规则编辑器页面
2. 点击"批量调整"按钮
3. 选择特征类型(如"参数")
4. 设置新权重值(如4.0)
5. 点击"确定"
6. 点击"保存修改"

**效果**:
- 修改当前规则中所有指定类型的特征权重
- 只影响这一个规则

**优点**:
- 比逐个修改快
- 可以按类型批量调整
- 不影响其他规则

**缺点**:
- 仍然需要对每个规则单独操作
- 如果有719个规则,还是很多工作

## 最佳实践

### 场景1: 调整全局权重策略

**情况**: 你想改变整个系统的匹配策略,比如让参数特征更重要

**推荐方法**: 重新生成所有规则

**步骤**:
1. 修改配置中的 `feature_weight_config`
2. 保存配置
3. 点击"重新生成规则"
4. 验证几个规则确认权重已更新

### 场景2: 微调个别规则

**情况**: 某个设备的匹配效果不好,需要调整权重

**推荐方法**: 手动修改单个规则

**步骤**:
1. 打开该规则的编辑器
2. 调整特征权重
3. 保存修改
4. 测试匹配效果

### 场景3: 添加新设备

**情况**: 导入新的设备数据

**自动处理**: 
- 系统会自动使用当前配置生成规则
- 新规则会使用最新的权重配置
- 无需手动操作

## 配置更新流程图

```
修改配置
    ↓
保存配置 → 配置存储到数据库
    ↓
选择操作:
    ├─→ 重新生成规则 → 所有规则使用新配置 → 完成
    │
    └─→ 不重新生成 → 已有规则保持不变
                    → 新规则使用新配置
```

## 常见问题

### Q1: 我修改了配置,为什么规则没有变化?

**A**: 配置只影响**新生成**的规则。已存在的规则不会自动更新。需要点击"重新生成规则"。

### Q2: 重新生成规则会丢失我的手动调整吗?

**A**: 是的。重新生成会覆盖所有规则,包括手动调整的部分。如果有重要的手动调整,建议:
- 记录下来
- 或者只手动修改需要的规则,不要重新生成全部

### Q3: 我可以为不同的设备设置不同的权重策略吗?

**A**: 可以,但需要手动操作:
1. 使用配置生成初始规则
2. 在规则编辑器中为特定设备调整权重
3. 不要点击"重新生成规则"(会覆盖调整)

### Q4: 配置中的权重范围是多少?

**A**: 
- 最小值: 0.0
- 最大值: 10.0
- 精度: 0.1
- 推荐范围: 1.0 - 5.0

### Q5: 如何验证新权重是否生效?

**A**: 
1. 重新生成规则后
2. 打开任意规则的编辑器
3. 查看特征列表中的权重值
4. 确认与配置中的设置一致

## 相关文档

- [配置管理用户指南](./CONFIG_MANAGEMENT_USER_GUIDE.md)
- [规则编辑器修复说明](./RULE_EDITOR_FIX.md)
- [规则重新生成功能](./CONFIG_REGENERATE_RULES_FIX.md)
