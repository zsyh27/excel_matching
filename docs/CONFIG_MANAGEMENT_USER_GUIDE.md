# 配置管理功能使用指南

## 概述

配置管理功能提供了一个可视化界面，让您无需修改代码即可调整所有匹配相关的参数。这大大提高了系统的可维护性和灵活性。

## 访问配置管理页面

在浏览器中访问：`http://localhost:3000/config-management`

## 功能说明

### 1. 删除无关关键词 (ignore_keywords)

**作用**：在预处理的第一步，删除这些与设备匹配无关的关键词。

**使用场景**：
- 过滤掉"施工要求"、"验收"、"图纸"等非设备信息
- 提高匹配准确性

**操作**：
- 输入新关键词，点击"添加"
- 点击关键词旁的"×"删除

### 2. 处理分隔符 (feature_split_chars)

**作用**：定义用于拆分特征的分隔符。

**使用场景**：
- 将"温度传感器+湿度传感器"拆分为两个独立特征
- 支持多种分隔符：`+`、`;`、`、`、`|`等

**操作**：
- 输入新分隔符，点击"添加"
- 系统会显示字符的Unicode编码
- 点击"删除"按钮移除分隔符

### 3. 同义词映射 (synonym_map)

**作用**：将不同的词汇映射到统一的标准词。

**使用场景**：
- "温度传感器" → "温传感器"
- "湿度传感器" → "湿传感器"
- 统一不同的表达方式

**操作**：
- 输入原词和目标词
- 点击"添加"创建映射
- 点击"删除"移除映射

### 4. 归一化映射 (normalization_map)

**作用**：将各种格式的字符统一转换为标准格式。

**使用场景**：
- 单位符号统一：`℃` → `` (删除)
- 符号转换：`~` → `-`
- 全角转半角：`～` → `-`

**操作**：
- 输入原字符和目标字符
- 目标字符为空表示删除该字符
- 点击"添加"创建映射

### 5. 全局配置 (global_config)

**作用**：全局处理选项。

**配置项**：
- **默认匹配阈值**：规则匹配的最低得分要求（0-10）
- **统一转小写**：将所有文本转换为小写
- **删除空格**：删除文本中的所有空格
- **全角转半角**：将全角字符转换为半角字符

**操作**：
- 使用滑块或输入框调整阈值
- 使用开关按钮切换布尔选项

### 6. 品牌关键词 (brand_keywords)

**作用**：定义品牌关键词，用于智能识别和拆分设备描述中的品牌信息。

**使用场景**：
- 识别"霍尼韦尔"、"西门子"等品牌
- 将"霍尼韦尔温度传感器"拆分为"霍尼韦尔"和"温传感器"

**操作**：
- 输入新品牌名称，点击"添加"
- 点击品牌标签上的"×"删除

### 7. 设备类型关键词 (device_type_keywords)

**作用**：定义设备类型关键词，用于智能识别和拆分设备描述中的设备类型信息。

**使用场景**：
- 识别"传感器"、"控制器"、"DDC"等设备类型
- 智能拆分复合描述

**操作**：
- 输入新设备类型，点击"添加"
- 点击类型标签上的"×"删除

## 实时预览

在页面底部的"实时预览"区域，您可以：

1. **输入测试文本**：输入任意设备描述
2. **查看预处理结果**：
   - 原始文本
   - 清理后的文本
   - 归一化后的文本
   - 提取的特征列表
3. **查看匹配结果**：
   - 匹配状态（成功/失败）
   - 匹配的设备
   - 匹配得分

## 保存配置

1. 修改配置后，页面顶部的"保存"按钮会变为可用状态
2. 点击"保存"按钮
3. 输入备注信息（可选）
4. 确认保存

**注意**：保存配置后，系统会自动重新加载配置，无需重启服务。

## 配置管理操作

### 重置配置

点击"重置"按钮，恢复到上次保存的状态。所有未保存的修改将丢失。

### 导出配置

1. 点击"导出"按钮
2. 系统会下载一个JSON文件
3. 文件名格式：`config_export_时间戳.json`

**用途**：
- 备份当前配置
- 分享配置给其他团队成员
- 在不同环境间迁移配置

### 导入配置

1. 点击"导入"按钮
2. 选择之前导出的JSON文件
3. 输入备注信息（可选）
4. 确认导入

**注意**：导入会覆盖当前配置，建议先导出备份。

### 版本历史

1. 点击左侧边栏底部的"📜 版本历史"
2. 查看所有历史版本
3. 每个版本显示：
   - 版本号
   - 创建时间
   - 备注信息
4. 点击"回滚"按钮恢复到指定版本

**用途**：
- 查看配置修改历史
- 回滚到之前的版本
- 对比不同版本的效果

## 配置修改后的影响

### 自动生效

配置保存后，以下组件会自动重新加载：
- 文本预处理器
- 匹配引擎
- 设备行分类器

### 需要重新生成规则

如果修改了以下配置，建议重新生成规则：
- 同义词映射
- 归一化映射
- 品牌关键词
- 设备类型关键词

**重新生成规则的方法**：
```bash
cd backend
python generate_rules_for_devices.py --config ../data/static_config.json --all
```

## 最佳实践

### 1. 测试驱动的配置调整

1. 在实时预览中输入测试文本
2. 观察预处理和匹配结果
3. 根据结果调整配置
4. 重复测试直到满意
5. 保存配置

### 2. 增量修改

- 每次只修改一个配置项
- 测试效果后再修改下一个
- 避免一次性修改太多导致难以定位问题

### 3. 及时备注

- 每次保存配置时添加有意义的备注
- 说明修改的原因和预期效果
- 方便后续查看历史和回滚

### 4. 定期导出备份

- 每周导出一次配置备份
- 在重大修改前导出备份
- 保存在安全的位置

### 5. 使用版本历史

- 修改前查看当前版本号
- 测试新配置的效果
- 如果效果不佳，立即回滚

## 常见问题

### Q: 修改配置后需要重启服务吗？

A: 不需要。配置保存后会自动重新加载，立即生效。

### Q: 如何知道配置是否生效？

A: 使用实时预览功能，输入测试文本查看效果。

### Q: 配置历史保存在哪里？

A: 保存在数据库的 `config_history` 表中，同时文件系统也有备份（`data/config_backups/`）。

### Q: 可以同时编辑多个配置项吗？

A: 可以。系统会跟踪所有修改，点击保存时一次性保存所有变更。

### Q: 如何恢复到默认配置？

A: 查看版本历史，找到初始版本（版本1），点击回滚。

### Q: 配置文件在哪里？

A: `data/static_config.json`。但建议通过界面修改，而不是直接编辑文件。

## 技术细节

### 配置文件结构

```json
{
  "ignore_keywords": [...],
  "feature_split_chars": [...],
  "synonym_map": {...},
  "normalization_map": {...},
  "global_config": {...},
  "brand_keywords": [...],
  "device_type_keywords": [...]
}
```

### API端点

- `GET /api/config` - 获取当前配置
- `POST /api/config/save` - 保存配置
- `POST /api/config/validate` - 验证配置
- `POST /api/config/test` - 测试配置效果
- `GET /api/config/history` - 获取配置历史
- `POST /api/config/rollback` - 回滚配置
- `GET /api/config/export` - 导出配置
- `POST /api/config/import` - 导入配置

### 数据库表

```sql
CREATE TABLE config_history (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    version INTEGER NOT NULL UNIQUE,
    config_data TEXT NOT NULL,
    remark TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

## 总结

配置管理功能让您能够：
- ✅ 可视化编辑所有配置参数
- ✅ 实时预览配置效果
- ✅ 管理配置版本历史
- ✅ 导入导出配置
- ✅ 快速回滚到之前的版本

这大大提高了系统的可维护性和灵活性，让配置调整变得简单高效！
