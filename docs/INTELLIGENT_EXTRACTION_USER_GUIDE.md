# 智能特征提取用户指南

## 功能简介

智能特征提取是一个自动识别并删除Excel文本中无效信息的功能，帮助提高设备匹配的准确性。

### 解决的问题

在实际使用中，Excel设备描述常常包含大量无关信息：

**问题示例**:
```
36,室内CO2传感器,1.名称:室内CO2传感器2.规格：485传输方式，量程0-2000ppm；
输出信号4~20mA/2~10VDC；精度±5%@25C.50%RH(0~100ppm)，485通讯3.施工要求:
按照图纸规范要求配置，含该项施工内容所包含的全部主材、辅材、配件、采购、
运输、保管、施工、安装、调试、验收等全部费用
```

**包含的无效信息**:
- ❌ "36" - Excel行号
- ❌ "1.名称:", "2.规格:" - 元数据标签
- ❌ "3.施工要求:..." - 施工相关的大段描述

这些无效信息会：
- 干扰设备匹配
- 降低匹配准确率
- 提取出大量无用特征

### 智能清理效果

启用智能清理后：

**清理后的文本**:
```
室内CO2传感器,室内CO2传感器485传输方式，0-2000ppm；4~20mA/2~10VDC；
精度±5%@25C.50%RH(0~100ppm)，485通讯
```

**改进效果**:
- ✅ 删除了施工要求段落（83字符，50.3%）
- ✅ 删除了部分元数据标签
- ✅ 保留了设备核心信息
- ✅ 提高了匹配准确性

## 启用方法

### 方法1: 通过配置文件（推荐）

1. 打开配置文件 `data/static_config.json`

2. 找到 `intelligent_extraction` 配置节

3. 设置 `enabled` 为 `true`:
```json
{
  "intelligent_extraction": {
    "enabled": true,
    "text_cleaning": {
      "enabled": true
    }
  }
}
```

4. 保存文件

5. 重新生成规则并匹配

### 方法2: 通过配置管理界面（开发中）

1. 进入"配置管理"页面
2. 选择"高级配置"
3. 启用"智能特征提取"
4. 保存配置

## 查看清理效果

### 在匹配详情中查看

1. 上传Excel文件并执行匹配

2. 点击任意匹配结果的"查看详情"按钮

3. 切换到"特征提取"标签页

4. 查看处理流程：
   - **原始文本** - Excel中的原始内容
   - **智能清理** ⭐ - 自动删除噪音和无效信息
   - **清理后** - 删除无关关键词
   - **归一化** - 统一格式
   - **特征提取** - 识别关键信息

5. 在"智能清理"阶段查看统计信息：
   - 📏 原始长度
   - ✂️ 清理后长度
   - 🗑️ 删除长度
   - 删除比例

### 清理效果提示

- **成功提示**（绿色）: 成功删除了XX个字符的噪音信息
- **信息提示**（蓝色）: 原始文本较为干净，无需智能清理

## 配置清理规则

### 1. 配置噪音截断分隔符

在遇到这些分隔符时，截断后面的所有内容：

```json
{
  "intelligent_extraction": {
    "text_cleaning": {
      "truncate_delimiters": [
        {
          "pattern": "\\d+\\.?施工要求[:：]",
          "description": "在施工要求处截断"
        },
        {
          "pattern": "\\d+\\.?验收标准[:：]",
          "description": "在验收标准处截断"
        }
      ]
    }
  }
}
```

**效果**: 
- 输入: "设备描述...3.施工要求:按照图纸..."
- 输出: "设备描述..."

### 2. 配置噪音段落模式

删除匹配这些模式的段落：

```json
{
  "intelligent_extraction": {
    "text_cleaning": {
      "noise_section_patterns": [
        {
          "pattern": "按照.*?(?:图纸|规范|清单).*?(?:要求|配置)",
          "description": "删除按照图纸规范的描述"
        },
        {
          "pattern": "含.*?(?:主材|辅材|配件).*?(?:费用|价格)",
          "description": "删除费用相关描述"
        }
      ]
    }
  }
}
```

**效果**: 删除"按照图纸规范要求配置"等描述性文字

### 3. 配置元数据标签模式

删除这些元数据标签，保留值：

```json
{
  "intelligent_extraction": {
    "metadata_label_patterns": [
      "\\d+\\.?名称[:：]",
      "\\d+\\.?规格[:：]",
      "型号[:：]",
      "量程[:：]?",
      "输出信号[:：]?",
      "精度[:：]?"
    ]
  }
}
```

**效果**:
- 输入: "1.名称:室内CO2传感器"
- 输出: "室内CO2传感器"

## 常见问题

### Q1: 智能清理会不会删除有用信息？

A: 不会。智能清理只删除：
- 施工要求等大段无关描述
- "名称:"、"规格:"等元数据标签
- 保留所有设备核心信息（名称、品牌、型号、参数）

### Q2: 如何知道智能清理是否生效？

A: 查看匹配详情的"特征提取"标签页：
- 如果显示"智能清理"阶段，说明已启用
- 查看"删除长度"统计，如果>0说明生效
- 对比"原始文本"和清理后的文本

### Q3: 智能清理后匹配效果变差了怎么办？

A: 可能是清理规则过于激进：
1. 检查配置文件中的清理规则
2. 调整或删除某些规则
3. 临时禁用智能清理：设置 `enabled: false`
4. 联系技术支持

### Q4: 可以自定义清理规则吗？

A: 可以。编辑 `data/static_config.json`：
- 添加新的截断分隔符
- 添加新的噪音段落模式
- 添加新的元数据标签模式
- 使用正则表达式匹配复杂模式

### Q5: 智能清理会影响性能吗？

A: 影响很小：
- 处理时间增加约5-10ms
- 内存占用无明显增加
- 对用户体验无影响

## 最佳实践

### 1. 逐步启用

建议按以下顺序启用功能：

1. **第一步**: 只启用噪音截断
   ```json
   {
     "text_cleaning": {
       "enabled": true,
       "truncate_delimiters": [...]
     }
   }
   ```

2. **第二步**: 添加噪音段落删除
   ```json
   {
     "noise_section_patterns": [...]
   }
   ```

3. **第三步**: 添加元数据标签删除
   ```json
   {
     "metadata_label_patterns": [...]
   }
   ```

### 2. 验证效果

每次修改配置后：
1. 重新生成规则
2. 执行匹配测试
3. 查看匹配详情
4. 验证清理效果
5. 检查匹配准确率

### 3. 保留备份

修改配置前：
1. 备份 `data/static_config.json`
2. 记录修改内容
3. 如果效果不好，可以恢复

### 4. 针对性配置

根据实际Excel格式调整：
- 如果包含"施工要求"，添加截断规则
- 如果包含"验收标准"，添加截断规则
- 如果包含"1.名称:"，添加元数据标签规则

## 技术原理

### 处理流程

```
原始文本
    ↓
【智能清理】
    ├─ 在噪音分隔符处截断
    ├─ 删除噪音段落
    └─ 删除元数据标签
    ↓
【删除无关关键词】
    └─ 删除配置的无关关键词
    ↓
【归一化】
    ├─ 同义词映射
    ├─ 全角转半角
    └─ 统一大小写
    ↓
【特征提取】
    ├─ 按分隔符拆分
    ├─ 智能识别品牌和设备类型
    └─ 过滤和去重
    ↓
有效特征列表
```

### 核心优势

1. **自动化**: 无需手动编辑Excel
2. **智能化**: 自动识别无效信息
3. **可配置**: 灵活调整清理规则
4. **可视化**: 清理过程透明可见
5. **可控制**: 可随时启用/禁用

## 相关文档

- 设计文档: `INTELLIGENT_FEATURE_EXTRACTION_SOLUTION.md`
- 实施记录: `INTELLIGENT_EXTRACTION_IMPLEMENTATION.md`
- 进度报告: `INTELLIGENT_EXTRACTION_PROGRESS.md`
- 配置文件: `data/static_config.json`

## 技术支持

如有问题，请：
1. 查看匹配详情中的清理效果
2. 检查配置文件是否正确
3. 查看系统日志
4. 联系技术支持团队

---

**版本**: v1.0
**最后更新**: 2026-02-28
