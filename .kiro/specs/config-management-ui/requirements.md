# 配置管理界面 - 需求文档

## 1. 功能概述

创建一个可视化的配置管理界面，让用户无需修改代码即可调整所有匹配相关的参数，包括同义词映射、品牌关键词、设备类型关键词、归一化映射等。

## 2. 用户故事

### 2.1 配置调整
**作为** 系统管理员  
**我想要** 在界面上直接编辑配置参数  
**以便** 快速调整匹配规则，无需修改代码和重启服务

**验收标准**：
- 可以查看所有配置项
- 可以编辑所有配置项
- 修改后可以保存
- 保存后立即生效

### 2.2 实时预览
**作为** 系统管理员  
**我想要** 在修改配置后立即看到效果  
**以便** 验证配置是否符合预期

**验收标准**：
- 可以输入测试文本
- 实时显示预处理结果
- 实时显示匹配结果
- 可以对比修改前后的效果

### 2.3 配置历史
**作为** 系统管理员  
**我想要** 查看配置的修改历史  
**以便** 了解配置的演变过程，必要时回滚

**验收标准**：
- 可以查看配置历史列表
- 每条历史记录包含版本号、修改时间、备注
- 可以回滚到任意历史版本
- 回滚后自动重新生成规则

### 2.4 规则重新生成
**作为** 系统管理员  
**我想要** 配置修改后自动重新生成规则  
**以便** 确保新配置立即应用到匹配过程

**验收标准**：
- 保存配置后提示重新生成规则
- 显示生成进度
- 生成完成后自动刷新
- 生成失败时显示错误信息

### 2.5 配置导入导出
**作为** 系统管理员  
**我想要** 导出和导入配置  
**以便** 在不同环境间迁移配置或备份配置

**验收标准**：
- 可以导出配置为JSON文件
- 可以导入JSON配置文件
- 导入前验证配置格式
- 导入后自动保存并生成规则

## 3. 功能需求

### 3.1 配置项管理

#### 3.1.1 忽略关键词 (ignore_keywords)
- 显示当前的忽略关键词列表
- 支持添加新关键词
- 支持删除关键词
- 支持搜索和过滤
- 显示每个关键词的使用频率

#### 3.1.2 特征拆分字符 (feature_split_chars)
- 显示当前的拆分字符列表
- 支持添加新字符
- 支持删除字符
- 支持排序（影响拆分优先级）
- 可视化显示特殊字符

#### 3.1.3 同义词映射 (synonym_map)
- 表格形式显示（原词 → 目标词）
- 支持添加、编辑、删除
- 支持批量导入（CSV格式）
- 检测循环引用
- 实时搜索和过滤

#### 3.1.4 归一化映射 (normalization_map)
- 表格形式显示（原字符 → 目标字符）
- 分组显示（温度单位、符号、单位等）
- 支持添加、编辑、删除
- 显示影响的设备数量

#### 3.1.5 品牌关键词 (brand_keywords)
- 标签云形式显示
- 支持添加、删除
- 支持拖拽排序
- 分组管理（国产/进口）

#### 3.1.6 设备类型关键词 (device_type_keywords)
- 列表形式显示
- 支持添加、编辑、删除
- 支持拖拽排序（按长度排序很重要）
- 显示每个关键词的使用频率

#### 3.1.7 全局配置 (global_config)
- 表单形式显示
- 数值输入框（带滑块）
- 开关按钮（布尔值）
- 实时显示影响范围

### 3.2 实时预览

#### 3.2.1 测试输入
- 文本输入框
- 支持多行输入
- 保存最近的测试文本

#### 3.2.2 预处理结果
- 显示原始文本
- 显示清理后的文本
- 显示归一化后的文本
- 显示提取的特征列表

#### 3.2.3 匹配结果
- 显示匹配的设备
- 显示匹配得分
- 显示匹配原因
- 显示候选设备列表（前10个）

### 3.3 配置管理

#### 3.3.1 保存配置
- 验证配置格式
- 自动备份当前配置
- 保存到JSON文件
- 记录到数据库历史

#### 3.3.2 重置配置
- 恢复到默认配置
- 二次确认
- 自动重新生成规则

#### 3.3.3 导入配置
- 上传JSON文件
- 验证配置格式
- 显示配置差异
- 确认后保存

#### 3.3.4 导出配置
- 下载JSON文件
- 包含所有配置项
- 格式化输出

### 3.4 版本历史

#### 3.4.1 历史列表
- 显示版本号
- 显示修改时间
- 显示备注信息
- 分页显示

#### 3.4.2 版本对比
- 选择两个版本
- 高亮显示差异
- 支持并排对比

#### 3.4.3 版本回滚
- 选择历史版本
- 显示版本详情
- 确认后回滚
- 自动重新生成规则

### 3.5 规则重新生成

#### 3.5.1 触发生成
- 保存配置后自动提示
- 手动触发按钮
- 后台异步执行

#### 3.5.2 进度显示
- 显示进度条
- 显示当前进度（X/总数）
- 显示预计剩余时间

#### 3.5.3 完成通知
- 生成成功提示
- 生成失败提示
- 显示生成统计

## 4. 非功能需求

### 4.1 性能要求
- 配置加载时间 < 1秒
- 配置保存时间 < 2秒
- 实时预览响应时间 < 500ms（防抖后）
- 规则生成时间 < 2分钟（719个设备）

### 4.2 可用性要求
- 界面简洁直观
- 操作流程清晰
- 错误提示友好
- 支持键盘快捷键

### 4.3 安全要求
- 配置修改需要权限验证
- 自动备份配置
- 防止配置注入攻击
- 记录操作日志

### 4.4 兼容性要求
- 支持Chrome、Firefox、Edge最新版本
- 响应式设计，支持不同屏幕尺寸
- 配置文件向后兼容

## 5. 约束条件

### 5.1 技术约束
- 前端：Vue 3 + Element Plus
- 后端：Flask
- 数据库：SQLite
- 配置存储：JSON文件 + 数据库历史

### 5.2 业务约束
- 配置修改立即生效
- 保留最近30天的配置历史
- 配置文件大小限制 < 1MB

## 6. 验收标准

### 6.1 功能完整性
- [ ] 所有配置项都可以编辑
- [ ] 实时预览功能正常
- [ ] 配置保存和加载正常
- [ ] 版本历史功能正常
- [ ] 规则重新生成功能正常
- [ ] 配置导入导出功能正常

### 6.2 用户体验
- [ ] 界面布局合理
- [ ] 操作流程顺畅
- [ ] 错误提示清晰
- [ ] 响应速度快

### 6.3 稳定性
- [ ] 配置验证准确
- [ ] 自动备份可靠
- [ ] 错误处理完善
- [ ] 无数据丢失风险

## 7. 优先级

### P0（必须实现）
- 配置读取和显示
- 基本编辑功能（同义词、品牌、设备类型）
- 配置保存
- 实时预览

### P1（重要）
- 所有配置项的编辑
- 配置验证
- 规则重新生成
- 配置历史

### P2（可选）
- 配置导入导出
- 版本对比
- 批量操作
- 智能推荐

## 8. 里程碑

### 里程碑 1：MVP（3天）
- 配置管理页面框架
- 同义词映射、品牌关键词、设备类型编辑器
- 配置保存API
- 基础实时预览

### 里程碑 2：核心功能（2天）
- 所有配置项编辑器
- 完整的实时预览
- 配置验证
- 规则重新生成

### 里程碑 3：完善功能（2天）
- 配置历史管理
- 配置导入导出
- 用户体验优化
- 完整测试

## 9. 风险和挑战

### 9.1 技术风险
- **风险**：规则生成时间过长，影响用户体验
- **缓解**：使用后台任务队列，显示进度

### 9.2 数据风险
- **风险**：配置错误导致匹配失败
- **缓解**：配置验证、自动备份、版本回滚

### 9.3 性能风险
- **风险**：配置项过多，界面卡顿
- **缓解**：虚拟滚动、分页加载、懒加载

## 10. 成功指标

- 配置调整时间从 10 分钟降低到 2 分钟
- 配置错误率降低 80%
- 用户满意度 > 4.5/5
- 所有配置项都可以通过界面修改
