# 实施任务清单

- [x] 1. 项目初始化与环境搭建





  - 创建项目目录结构（backend、frontend、data、temp）
  - 配置 Python 虚拟环境和依赖（Flask、openpyxl、xlrd、pytest、hypothesis）
  - 配置 Vue 3 项目和依赖（Element Plus、Axios）
  - 创建初始的三个 JSON 数据文件（static_device.json、static_rule.json、static_config.json）
  - _需求: 7.1, 7.2, 7.3_

- [x] 2. 实现文本预处理核心模块





  - 创建 TextPreprocessor 类，实现统一的 preprocess() 方法
  - 实现关键词过滤功能（remove_ignore_keywords）
  - 实现三层归一化功能（normalize_text）：精准映射、通用归一化、模糊兼容
  - 实现特征拆分功能（extract_features）
  - 确保所有功能从 static_config.json 加载配置
  - _需求: 3.1, 3.2, 3.3, 3.4, 3.5, 3.6, 3.7_

- [ ]* 2.1 编写文本预处理模块的属性测试
  - **属性 5: 归一化映射应用** - 验证配置文件中的字符映射正确应用
  - **属性 6: 特征拆分正确性** - 验证特征拆分和重组的一致性
  - **验证需求: 3.2, 3.6**

- [x] 3. 实现数据加载与校验模块





  - 创建 DataLoader 类，实现三个 JSON 文件的加载功能
  - 实现数据完整性校验（validate_data_integrity）
  - 实现自动特征生成功能（auto_generate_features），复用 TextPreprocessor
  - 实现规则表与设备表自动同步功能（auto_sync_rules_with_devices）
  - 实现 ConfigManager 类，支持配置热加载
  - _需求: 7.1, 7.2, 7.3, 7.4, 7.5, 7.6_

- [ ]* 3.1 编写数据加载模块的属性测试
  - **属性 16: 自动特征生成一致性** - 验证自动生成的特征包含所有必需信息
  - **验证需求: 7.5**

- [x] 4. 实现 Excel 解析模块





  - 创建 ExcelParser 类
  - 实现文件格式检测功能（detect_format）
  - 实现 xls 格式解析（使用 xlrd）
  - 实现 xlsx/xlsm 格式解析（使用 openpyxl）
  - 实现空行过滤功能（filter_empty_rows）：过滤全空行和伪空行
  - 实现行类型分类功能（classify_row_type）：识别 header/device/summary/remark
  - 集成 TextPreprocessor 对设备描述进行预处理
  - _需求: 1.1, 1.2, 1.3, 1.5, 2.1, 2.2, 2.3, 2.4, 2.5, 2.6, 2.7_

- [ ]* 4.1 编写 Excel 解析模块的属性测试
  - **属性 1: 多格式 Excel 文件接受** - 验证 xls/xlsm/xlsx 格式都能成功解析
  - **属性 3: 空行过滤一致性** - 验证过滤后的行数等于有效行数
  - **属性 4: 行类型标注完整性** - 验证每行都有正确的类型标注
  - **验证需求: 1.1, 1.2, 1.3, 2.1, 2.2, 2.7**

- [x] 5. 实现匹配引擎模块





  - 创建 MatchEngine 类
  - 实现权重得分计算功能（calculate_weight_score）
  - 实现匹配判定逻辑：比较权重得分与阈值
  - 实现最佳匹配选择功能（select_best_match）：选择权重最高的规则
  - 实现兜底机制：使用 default_match_threshold 再次判定
  - 实现设备信息检索功能：通过 target_device_id 从设备表获取完整信息
  - 实现标准化返回格式：包含 device_id、matched_device_text、unit_price、match_status、match_score、match_reason
  - _需求: 4.1, 4.2, 4.3, 4.4, 4.5, 4.6, 4.7, 4.8_

- [ ]* 5.1 编写匹配引擎模块的属性测试
  - **属性 7: 权重累计单调性** - 验证特征越多权重得分越高
  - **属性 8: 最佳匹配选择** - 验证选择权重最高的规则
  - **属性 9: 设备信息检索往返** - 验证通过 device_id 检索的一致性
  - **验证需求: 4.3, 4.5, 4.8**

- [x] 6. 实现 Excel 导出模块





  - 创建 ExcelExporter 类
  - 实现原文件格式读取功能：读取合并单元格、行列顺序、工作表结构
  - 实现格式保留功能（preserve_format）：复制合并单元格配置
  - 实现新列添加功能（add_new_columns）：在最后添加"匹配设备"和"单价"列
  - 实现数据填充功能：使用标准化的 match_result 格式填充数据
  - 实现格式转换功能：xls 转 xlsx，xlsx/xlsm 保持原格式
  - 实现设备信息格式化功能（format_matched_device）：品牌+设备名称+规格型号+详细参数
  - _需求: 6.1, 6.2, 6.3, 6.4, 6.5, 6.6, 6.7, 6.8, 6.9, 6.10_

- [ ]* 6.1 编写 Excel 导出模块的属性测试
  - **属性 10: 匹配设备格式完整性** - 验证显示文本包含所有必需部分
  - **属性 12: 价格格式一致性** - 验证单价保留两位小数
  - **属性 13: Excel 格式往返保留** - 验证合并单元格配置保持一致
  - **属性 14: 行列顺序不变性** - 验证行列顺序和新列位置正确
  - **属性 15: 数据完整性保持** - 验证所有非空行都被保留
  - **验证需求: 5.2, 5.7, 6.1, 6.2, 6.4, 6.5, 6.7, 6.10**

- [x] 7. 实现后端 API 路由层








  - 创建 Flask 应用入口（app.py）
  - 实现文件上传接口（POST /api/upload）：接收文件，保存到临时目录，返回 file_id
  - 实现文件解析接口（POST /api/parse）：调用 ExcelParser，返回解析结果
  - 实现设备匹配接口（POST /api/match）：调用 MatchEngine，返回标准化匹配结果
  - 实现设备列表接口（GET /api/devices）：返回所有设备信息
  - 实现 Excel 导出接口（POST /api/export）：调用 ExcelExporter，返回文件流
  - 实现配置管理接口（GET/PUT /api/config）：获取和更新配置
  - 实现统一的错误处理中间件
  - _需求: 1.4, 9.1, 9.2, 9.3, 9.4, 9.5, 9.6_

- [ ]* 7.1 编写 API 接口的单元测试
  - 测试文件上传接口的格式验证
  - 测试非 Excel 文件的拒绝逻辑
  - 测试错误响应的格式和内容
  - _需求: 1.4, 9.1, 9.2, 9.5, 9.6_

- [x] 8. 实现前端文件上传组件





  - 创建 FileUpload.vue 组件
  - 实现文件选择和拖拽上传功能
  - 实现文件格式验证（仅允许 xls/xlsm/xlsx）
  - 实现上传进度显示
  - 实现上传成功/失败的通知提示
  - 调用后端 /api/upload 和 /api/parse 接口
  - _需求: 1.1, 1.2, 1.3, 1.4, 9.1, 9.2_

- [x] 9. 实现前端结果展示组件





  - 创建 ResultTable.vue 组件
  - 使用 Element Plus Table 组件展示解析结果
  - 实现列定义：原始行号、设备描述、匹配设备、单价
  - 实现匹配成功状态显示：显示完整设备信息和单价
  - 实现匹配失败状态显示：黄色背景显示"待人工匹配"，单价显示 0.00
  - 实现下拉选择器：加载所有设备，支持手动选择
  - 实现手动选择后的数据更新：同步更新匹配设备和单价
  - 实现匹配统计信息显示：总数、成功数、失败数、准确率
  - _需求: 5.1, 5.2, 5.3, 5.4, 5.5, 5.6, 5.7, 5.8, 9.3_

- [ ]* 9.1 编写前端组件的属性测试
  - **属性 11: 手动选择价格同步** - 验证手动选择后单价自动更新
  - **验证需求: 5.6**

- [x] 10. 实现前端导出功能





  - 创建 ExportButton.vue 组件
  - 实现导出按钮和点击事件
  - 调用后端 /api/export 接口
  - 实现文件下载触发
  - 实现导出成功/失败的通知提示
  - _需求: 9.4, 9.5_

- [x] 11. 集成前后端并进行端到端测试









  - 配置前端代理，连接后端 API
  - 测试完整流程：上传 → 解析 → 匹配 → 人工调整 → 导出
  - 验证导出的 Excel 文件格式正确、数据完整
  - 测试多种 Excel 格式（xls/xlsm/xlsx）
  - 测试边界情况：空文件、大文件、特殊字符
  - _需求: 所有需求_

- [ ]* 11.1 编写性能测试
  - **属性 17: 匹配准确率下界** - 使用真实数据集验证准确率≥85%
  - **属性 18: 解析性能上界** - 验证 1000 行 Excel 在 5 秒内解析完成
  - **属性 19: 匹配性能上界** - 验证 1000 个设备描述在 10 秒内匹配完成
  - **验证需求: 8.1, 8.2, 8.3, 8.4**

- [x] 12. 准备示例数据和文档







  - 创建示例设备数据（至少 20 个设备，覆盖 DDC 控制器、传感器、控制柜等）
  - 创建示例匹配规则（与设备一一对应）
  - 创建示例配置文件（包含常见的归一化映射）
  - 创建示例 Excel 设备清单（包含标准和非标准格式）
  - 编写 README.md：项目说明、安装步骤、使用指南
  - 编写 MAINTENANCE.md：数据维护指南、配置说明、故障排查
  - _需求: 所有需求_

- [x] 13. 最终验收检查点





  - 确保所有测试通过，代码无错误
  - 验证匹配准确率达到≥85%
  - 验证性能指标达标（解析≤5秒，匹配≤10秒）
  - 验证导出的 Excel 格式完整、数据准确
  - 验证前端交互流畅、提示清晰
  - 验证文档完整、可操作
  - 如有问题，请向用户反馈
  - _需求: 所有需求_
