# ResultTable 组件实现文档

## 概述

ResultTable.vue 是 DDC 设备清单匹配报价系统的核心展示组件，负责显示设备匹配结果、提供人工调整功能、展示统计信息以及触发导出操作。

## 功能实现

### 1. 列定义（需求 5.1）

实现了四列展示：
- **行号**: 显示原始 Excel 文件中的行号
- **设备描述**: 显示原始设备描述文本
- **匹配设备**: 显示匹配结果或提供手动选择
- **单价**: 显示设备单价，保留两位小数

### 2. 匹配成功状态显示（需求 5.2, 5.7）

当设备匹配成功时：
- 显示完整设备信息（品牌 + 设备名称 + 规格型号 + 详细参数）
- 显示单价，格式化为两位小数
- 显示绿色的"匹配成功"标签和匹配得分

### 3. 匹配失败状态显示（需求 5.3, 5.8）

当设备匹配失败时：
- 行背景显示为黄色（通过 CSS 类 `unmatched-row`）
- 显示下拉选择器，提示"待人工匹配"
- 单价显示为 0.00
- 显示黄色的"待人工匹配"标签

### 4. 下拉选择器（需求 5.4）

实现特性：
- 加载所有设备列表（通过 `/api/devices` 接口）
- 支持搜索过滤（`filterable` 属性）
- 支持清除选择（`clearable` 属性）
- 显示设备的品牌、名称和规格型号

### 5. 手动选择后的数据更新（需求 5.5, 5.6）

当用户手动选择设备时：
- 自动更新匹配设备列，显示完整设备信息
- 自动更新单价列，同步设备的 unit_price
- 更新匹配结果对象的所有字段
- 重新计算统计信息
- 显示成功提示消息

### 6. 匹配统计信息显示（需求 5.8, 9.3）

实现了四个统计指标：
- **总设备数**: 设备行的总数量
- **匹配成功**: 成功匹配的设备数量（绿色边框）
- **匹配失败**: 需要人工匹配的设备数量（黄色边框）
- **准确率**: 匹配成功率百分比（蓝色边框）

统计面板使用渐变背景和卡片式设计，提供良好的视觉效果。

### 7. 导出功能（需求 9.4, 9.5）

实现特性：
- 点击"导出报价清单"按钮触发导出
- 调用 `/api/export` 接口
- 处理二进制文件流（`responseType: 'blob'`）
- 自动触发浏览器下载
- 显示导出成功/失败通知

## 组件接口

### Props

```javascript
{
  fileId: {
    type: String,
    default: null
  },
  parseResult: {
    type: Object,
    default: null
  }
}
```

### Emits

```javascript
['export-success']
```

### Exposed Methods

```javascript
{
  reset() // 重置组件状态
}
```

## 数据流

1. **初始化**: 组件接收 `parseResult` prop
2. **加载设备**: 调用 `/api/devices` 获取所有设备列表
3. **自动匹配**: 调用 `/api/match` 进行设备匹配
4. **显示结果**: 渲染表格和统计信息
5. **人工调整**: 用户通过下拉框选择设备
6. **导出**: 调用 `/api/export` 生成报价清单

## 样式设计

### 统计面板
- 渐变背景（紫色系）
- 白色半透明卡片
- 悬停时轻微上浮效果
- 彩色左边框区分不同指标

### 表格样式
- 斑马纹表格（`stripe`）
- 边框表格（`border`）
- 非设备行灰色背景
- 未匹配行黄色背景
- 价格红色加粗显示

### 设备选择器
- 两行显示：主信息 + 副信息
- 主信息：品牌 + 设备名称
- 副信息：规格型号（灰色小字）

## API 调用

### 1. GET /api/devices
获取所有设备列表，用于填充下拉选择器。

### 2. POST /api/match
```json
{
  "rows": [...]
}
```
返回匹配结果和统计信息。

### 3. POST /api/export
```json
{
  "file_id": "uuid",
  "matched_rows": [...]
}
```
返回 Excel 文件二进制流。

## 错误处理

- 加载设备失败：显示错误消息，但不阻塞其他功能
- 匹配失败：显示错误消息，保持界面可用
- 导出失败：显示详细错误信息，包含失败原因

## 用户体验优化

1. **实时反馈**: 所有操作都有即时的视觉反馈
2. **加载状态**: 导出按钮显示加载动画
3. **空状态**: 无数据时显示友好的空状态提示
4. **工具提示**: 长文本自动显示省略号和悬停提示
5. **颜色编码**: 使用颜色区分不同状态（成功/失败/待处理）

## 验证需求覆盖

- ✅ 需求 5.1: 列定义（行号、设备描述、匹配设备、单价）
- ✅ 需求 5.2: 匹配成功状态显示
- ✅ 需求 5.3: 匹配失败状态显示（黄色背景）
- ✅ 需求 5.4: 下拉选择器加载所有设备
- ✅ 需求 5.5: 手动选择后更新匹配设备
- ✅ 需求 5.6: 手动选择后自动更新单价
- ✅ 需求 5.7: 单价保留两位小数
- ✅ 需求 5.8: 匹配统计信息显示
- ✅ 需求 9.3: 设备匹配接口调用
- ✅ 需求 9.4: 导出功能
- ✅ 需求 9.5: 导出成功/失败通知

## 测试建议

### 单元测试
1. 测试价格格式化函数
2. 测试行类名生成函数
3. 测试统计信息计算

### 集成测试
1. 测试完整的匹配流程
2. 测试手动选择设备功能
3. 测试导出功能

### 用户验收测试
1. 上传包含多种设备的 Excel 文件
2. 验证匹配结果显示正确
3. 手动调整部分设备
4. 导出并验证报价清单格式

## 未来优化方向

1. **批量操作**: 支持批量选择设备
2. **搜索过滤**: 在表格中添加搜索功能
3. **排序功能**: 支持按匹配得分排序
4. **导出选项**: 支持选择导出格式和内容
5. **历史记录**: 保存用户的手动调整记录
