# 前端集成流程测试指南

## 测试目的
验证任务 7 实现的路由集成和数据流转是否正常工作。

## 测试环境准备

### 1. 启动后端服务
```bash
cd backend
python app.py
```

### 2. 启动前端开发服务器
```bash
cd frontend
npm run dev
```

## 测试步骤

### 测试 1: 文件上传流程
1. 访问 `http://localhost:5173/`
2. 应该看到文件上传页面
3. 拖拽或选择一个 Excel 文件上传
4. 观察上传进度条
5. **预期结果**：
   - 上传成功后显示"分析完成"通知
   - 自动跳转到 `/device-row-adjustment/:excelId` 页面
   - URL 中包含 excel_id 参数

### 测试 2: 设备行调整页面
1. 在设备行调整页面，应该看到：
   - 所有行的列表
   - 每行的概率等级（高/中/低）
   - 颜色标注（浅蓝/浅黄/浅灰）
   - 手动调整下拉框
   - 批量操作按钮
   - 筛选功能
2. 尝试手动调整某些行
3. 点击"确认调整并进入匹配"按钮
4. **预期结果**：
   - 调整操作成功保存
   - 跳转到 `/matching/:excelId` 页面
   - 设备行数据正确传递

### 测试 3: 设备匹配页面
1. 在匹配页面，应该看到：
   - 匹配统计信息（总设备数、匹配成功、匹配失败、准确率）
   - 匹配结果表格
   - 仅包含最终确认的设备行
   - 导出按钮
   - 返回调整按钮
2. 点击"返回调整"按钮
3. **预期结果**：
   - 返回到设备行调整页面
   - 之前的调整记录仍然保留

### 测试 4: 导出功能
1. 在匹配页面点击"导出报价清单"按钮
2. **预期结果**：
   - 成功下载 Excel 文件
   - 文件仅包含最终设备行的匹配结果
   - 不包含表头、合计等无关行

## 测试检查点

### 路由功能
- [ ] 路由跳转正常
- [ ] URL 参数正确传递
- [ ] 页面标题正确更新
- [ ] 浏览器前进/后退按钮正常工作

### 数据流转
- [ ] excel_id 在各页面间正确传递
- [ ] 设备行数据从调整页面传递到匹配页面
- [ ] 手动调整记录正确保存和应用
- [ ] 最终设备行列表正确生成

### 用户体验
- [ ] 页面切换流畅
- [ ] 加载状态显示正确
- [ ] 错误提示清晰
- [ ] 操作反馈及时

## 常见问题排查

### 问题 1: 上传后没有跳转
**可能原因**：
- 后端 `/api/excel/analyze` 接口未正常工作
- 响应格式不正确

**排查方法**：
- 检查浏览器控制台错误
- 检查网络请求响应

### 问题 2: 调整页面数据未加载
**可能原因**：
- excel_id 未正确传递
- 后端缓存未保存分析结果

**排查方法**：
- 检查 URL 中的 excel_id
- 检查后端日志

### 问题 3: 匹配页面无数据
**可能原因**：
- 设备行数据未通过路由状态传递
- 数据格式转换错误

**排查方法**：
- 在 MatchingView 的 onMounted 中添加 console.log
- 检查 history.state.deviceRows

## 性能测试

### 测试场景 1: 小文件（<50行）
- 上传时间：< 2秒
- 分析时间：< 1秒
- 页面切换：< 500ms

### 测试场景 2: 中等文件（50-200行）
- 上传时间：< 5秒
- 分析时间：< 2秒
- 页面切换：< 500ms

### 测试场景 3: 大文件（>200行）
- 上传时间：< 10秒
- 分析时间：< 3秒
- 页面切换：< 1秒

## 测试结论

完成所有测试后，填写以下检查表：

- [ ] 所有路由功能正常
- [ ] 数据流转正确无误
- [ ] 用户体验流畅
- [ ] 性能满足要求
- [ ] 无明显错误或警告

**测试人员签名**：___________
**测试日期**：___________
