# 手动调整功能故障 - 用户操作指南

## 问题现象

在设备行智能识别与调整页面，选中设备行后，点击"手动调整"或"批量标记为设备行"时，提示：
```
调整失败: Request failed with status code 400
```

## 快速解决步骤

### 步骤1: 重启后端服务

1. 找到运行后端服务的终端窗口
2. 按 `Ctrl+C` 停止服务
3. 重新启动：
   ```bash
   cd backend
   python app.py
   ```
4. 等待看到以下输出：
   ```
   INFO - 系统组件初始化完成
   INFO - 启动 Flask 应用...
   * Running on http://0.0.0.0:5000
   ```

### 步骤2: 刷新浏览器并重新上传

1. 在浏览器中按 `Ctrl+Shift+R`（Windows）或 `Cmd+Shift+R`（Mac）强制刷新页面
2. 重新上传Excel文件
3. 等待分析完成，自动跳转到设备行调整页面
4. 尝试手动调整

### 步骤3: 如果问题仍然存在

运行测试脚本检查后端是否正常：

1. 打开新的终端窗口
2. 运行测试脚本：
   ```bash
   cd backend
   python test_manual_adjust_debug.py
   ```
3. 查看输出结果：
   - ✅ 如果全部显示"成功"，说明后端正常，问题可能在前端
   - ❌ 如果显示"失败"，说明后端有问题

### 步骤4: 查看后端日志

在后端服务的终端窗口中，查看日志输出。

**正常情况应该看到**:
```
INFO - 收到手动调整请求: {'excel_id': 'xxx-xxx-xxx', ...}
INFO - 当前缓存的excel_id列表: ['xxx-xxx-xxx']
INFO - 手动标记为设备行: 第6行
INFO - 成功更新 1 行的调整记录
```

**如果看到错误**:
```
ERROR - 无效的excel_id: xxx-xxx-xxx
ERROR - 可用的excel_id: []
```

这说明后端缓存为空，需要重新上传文件。

## 为什么会出现这个问题？

### 原因1: 后端服务重启

后端使用内存缓存存储分析结果。当后端服务重启时，缓存会被清空，导致之前上传的文件信息丢失。

**解决方案**: 重新上传文件

### 原因2: excel_id 不匹配

前端使用的`excel_id`与后端缓存中的不一致。

**解决方案**: 刷新浏览器并重新上传文件

### 原因3: 浏览器缓存问题

浏览器的sessionStorage中存储了旧的分析结果。

**解决方案**: 清除浏览器缓存或使用无痕模式

## 预防措施

### 1. 保持后端服务运行

在使用系统期间，不要重启后端服务。如果需要重启，请重新上传所有文件。

### 2. 不要刷新页面

在设备行调整页面，避免刷新浏览器页面。如果不小心刷新了，需要重新上传文件。

### 3. 使用最新的浏览器

建议使用Chrome、Edge或Firefox的最新版本。

## 需要帮助？

如果按照以上步骤仍然无法解决问题，请提供以下信息：

1. **后端日志**: 复制后端终端窗口中的日志输出
2. **测试脚本输出**: 运行`python test_manual_adjust_debug.py`的完整输出
3. **浏览器控制台**: 按F12打开开发者工具，切换到Console标签，复制所有错误信息
4. **网络请求**: 在开发者工具的Network标签中，找到失败的`/api/excel/manual-adjust`请求，复制请求和响应内容

---

**创建日期**: 2026-02-08  
**适用版本**: v1.2.1+
