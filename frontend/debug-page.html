<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>è°ƒè¯•é¡µé¢ç©ºç™½é—®é¢˜</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 1000px;
      margin: 50px auto;
      padding: 20px;
    }
    .section {
      margin: 20px 0;
      padding: 20px;
      border: 1px solid #ddd;
      border-radius: 8px;
    }
    button {
      padding: 10px 20px;
      margin: 5px;
      background: #409eff;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    button:hover {
      background: #66b1ff;
    }
    #result {
      margin-top: 20px;
      padding: 15px;
      background: #f5f5f5;
      border-radius: 4px;
      white-space: pre-wrap;
      word-wrap: break-word;
    }
    .error {
      color: #f56c6c;
    }
    .success {
      color: #67c23a;
    }
  </style>
</head>
<body>
  <h1>ğŸ” è°ƒè¯•é¡µé¢ç©ºç™½é—®é¢˜</h1>
  
  <div class="section">
    <h3>æ­¥éª¤ 1: æµ‹è¯•åç«¯ API</h3>
    <p>æµ‹è¯• /api/excel/preview ç«¯ç‚¹æ˜¯å¦æ­£å¸¸å·¥ä½œ</p>
    <button onclick="testBackendAPI()">æµ‹è¯•åç«¯ API</button>
  </div>

  <div class="section">
    <h3>æ­¥éª¤ 2: æµ‹è¯•å‰ç«¯ API å®¢æˆ·ç«¯</h3>
    <p>æµ‹è¯•å‰ç«¯çš„ API è°ƒç”¨æ˜¯å¦æ­£å¸¸</p>
    <button onclick="testFrontendAPI()">æµ‹è¯•å‰ç«¯ API å®¢æˆ·ç«¯</button>
  </div>

  <div class="section">
    <h3>æ­¥éª¤ 3: æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°</h3>
    <p>æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰ï¼ŒæŸ¥çœ‹ Console å’Œ Network æ ‡ç­¾é¡µ</p>
    <button onclick="openDevTools()">æŸ¥çœ‹æ§åˆ¶å°æ—¥å¿—</button>
  </div>

  <div class="section">
    <h3>æ­¥éª¤ 4: æ¸…é™¤ç¼“å­˜å¹¶é‡æ–°åŠ è½½</h3>
    <p>æ¸…é™¤æµè§ˆå™¨ç¼“å­˜ï¼Œç„¶åé‡æ–°è®¿é—®é¡µé¢</p>
    <button onclick="clearCacheAndReload()">æ¸…é™¤ç¼“å­˜å¹¶é‡æ–°åŠ è½½</button>
  </div>

  <div id="result"></div>

  <script>
    const fileId = '1b2eecc1-669c-4350-b792-02bacebca707';
    const resultDiv = document.getElementById('result');

    function log(message, type = 'info') {
      const timestamp = new Date().toLocaleTimeString();
      const className = type === 'error' ? 'error' : type === 'success' ? 'success' : '';
      resultDiv.innerHTML += `<div class="${className}">[${timestamp}] ${message}</div>`;
    }

    async function testBackendAPI() {
      log('å¼€å§‹æµ‹è¯•åç«¯ API...');
      try {
        const response = await fetch('http://localhost:5000/api/excel/preview', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            file_id: fileId,
            sheet_index: 0
          })
        });

        if (!response.ok) {
          throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }

        const data = await response.json();
        log('âœ… åç«¯ API å“åº”æˆåŠŸ', 'success');
        log('å“åº”æ•°æ®: ' + JSON.stringify(data, null, 2));
        
        if (data.data && data.data.sheets) {
          log(`âœ… æ‰¾åˆ° ${data.data.sheets.length} ä¸ªå·¥ä½œè¡¨`, 'success');
          log(`âœ… é¢„è§ˆæ•°æ®è¡Œæ•°: ${data.data.preview_data.length}`, 'success');
        }
      } catch (error) {
        log('âŒ åç«¯ API è°ƒç”¨å¤±è´¥: ' + error.message, 'error');
        log('é”™è¯¯è¯¦æƒ…: ' + error.stack, 'error');
      }
    }

    async function testFrontendAPI() {
      log('å¼€å§‹æµ‹è¯•å‰ç«¯ API å®¢æˆ·ç«¯...');
      log('æ³¨æ„ï¼šè¿™ä¸ªæµ‹è¯•éœ€è¦å‰ç«¯åº”ç”¨æ­£åœ¨è¿è¡Œ');
      
      // æ¨¡æ‹Ÿå‰ç«¯ API è°ƒç”¨
      try {
        const response = await fetch('http://localhost:5000/api/excel/preview', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            file_id: fileId,
            sheet_index: 0
          })
        });

        const data = await response.json();
        
        if (data.success) {
          log('âœ… å‰ç«¯ API å®¢æˆ·ç«¯å·¥ä½œæ­£å¸¸', 'success');
        } else {
          log('âŒ API è¿”å›å¤±è´¥: ' + (data.error_message || 'æœªçŸ¥é”™è¯¯'), 'error');
        }
      } catch (error) {
        log('âŒ å‰ç«¯ API è°ƒç”¨å¤±è´¥: ' + error.message, 'error');
      }
    }

    function openDevTools() {
      log('è¯·æŒ‰ F12 æ‰“å¼€å¼€å‘è€…å·¥å…·');
      log('ç„¶åè®¿é—®: http://localhost:3000/data-range-selection/' + fileId);
      log('æŸ¥çœ‹ Console æ ‡ç­¾é¡µçš„é”™è¯¯ä¿¡æ¯');
      log('æŸ¥çœ‹ Network æ ‡ç­¾é¡µçš„ç½‘ç»œè¯·æ±‚');
      console.log('=== è°ƒè¯•ä¿¡æ¯ ===');
      console.log('æ–‡ä»¶ID:', fileId);
      console.log('åç«¯åœ°å€:', 'http://localhost:5000');
      console.log('å‰ç«¯åœ°å€:', 'http://localhost:3000');
    }

    function clearCacheAndReload() {
      log('æ­£åœ¨æ¸…é™¤ç¼“å­˜...');
      if ('caches' in window) {
        caches.keys().then(names => {
          names.forEach(name => {
            caches.delete(name);
          });
          log('âœ… ç¼“å­˜å·²æ¸…é™¤', 'success');
          log('è¯·æ‰‹åŠ¨åˆ·æ–°é¡µé¢ï¼ˆCtrl+Shift+R æˆ– Cmd+Shift+Rï¼‰');
        });
      } else {
        log('âš ï¸ æµè§ˆå™¨ä¸æ”¯æŒ Cache API');
        log('è¯·æ‰‹åŠ¨æ¸…é™¤ç¼“å­˜ï¼šCtrl+Shift+Delete');
      }
    }

    // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è¿è¡Œæµ‹è¯•
    window.onload = function() {
      log('=== è°ƒè¯•å·¥å…·å·²åŠ è½½ ===');
      log('æ–‡ä»¶ID: ' + fileId);
      log('ç‚¹å‡»ä¸Šé¢çš„æŒ‰é’®å¼€å§‹æµ‹è¯•');
    };
  </script>
</body>
</html>
