# DDC è®¾å¤‡æ¸…å•åŒ¹é…æŠ¥ä»·ç³»ç»Ÿ - æ•°æ®ç»´æŠ¤æŒ‡å—

æœ¬æ–‡æ¡£æä¾›ç³»ç»Ÿæ•°æ®ç»´æŠ¤ã€é…ç½®ç®¡ç†å’Œæ•…éšœæ’æŸ¥çš„è¯¦ç»†æŒ‡å—ã€‚

## ç›®å½•

- [æ•°æ®æ–‡ä»¶æ¦‚è¿°](#æ•°æ®æ–‡ä»¶æ¦‚è¿°)
- [æ•°æ®åº“æ¨¡å¼ç»´æŠ¤](#æ•°æ®åº“æ¨¡å¼ç»´æŠ¤)
- [JSONæ¨¡å¼ç»´æŠ¤](#jsonæ¨¡å¼ç»´æŠ¤)
- [é…ç½®æ–‡ä»¶ç®¡ç†](#é…ç½®æ–‡ä»¶ç®¡ç†)
- [è‡ªåŠ¨åŒ–å·¥å…·](#è‡ªåŠ¨åŒ–å·¥å…·)
- [æ•…éšœæ’æŸ¥](#æ•…éšœæ’æŸ¥)
- [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)

## æ•°æ®æ–‡ä»¶æ¦‚è¿°

ç³»ç»Ÿæ”¯æŒä¸¤ç§æ•°æ®å­˜å‚¨æ¨¡å¼ï¼š**æ•°æ®åº“æ¨¡å¼**ï¼ˆæ¨èï¼‰å’Œ **JSON æ–‡ä»¶æ¨¡å¼**ï¼ˆå‘åå…¼å®¹ï¼‰ã€‚

### æ•°æ®åº“æ¨¡å¼ï¼ˆæ¨èï¼‰

ä½¿ç”¨å…³ç³»å‹æ•°æ®åº“å­˜å‚¨è®¾å¤‡å’Œè§„åˆ™æ•°æ®ï¼Œæ”¯æŒå¤§è§„æ¨¡æ•°æ®ç®¡ç†ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   devices è¡¨        â”‚  è®¾å¤‡åŸºç¡€ä¿¡æ¯ï¼ˆçº¦720æ¡çœŸå®æ•°æ®ï¼‰
â”‚ - device_id (PK)    â”‚  è®¾å¤‡å”¯ä¸€æ ‡è¯†
â”‚ - brand             â”‚  å“ç‰Œ
â”‚ - device_name       â”‚  è®¾å¤‡åç§°
â”‚ - spec_model        â”‚  è§„æ ¼å‹å·
â”‚ - detailed_params   â”‚  è¯¦ç»†å‚æ•°
â”‚ - unit_price        â”‚  ä¸å«ç¨å•ä»·
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â†“ å¤–é”®å…³è”
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   rules è¡¨          â”‚  åŒ¹é…è§„åˆ™
â”‚ - rule_id (PK)      â”‚  è§„åˆ™å”¯ä¸€æ ‡è¯†
â”‚ - target_device_id  â”‚  å…³è”çš„è®¾å¤‡ID (FK)
â”‚   (FK)              â”‚
â”‚ - auto_extracted_   â”‚  è‡ªåŠ¨æå–çš„ç‰¹å¾ (JSON)
â”‚   features          â”‚
â”‚ - feature_weights   â”‚  ç‰¹å¾æƒé‡æ˜ å°„ (JSON)
â”‚ - match_threshold   â”‚  åŒ¹é…é˜ˆå€¼
â”‚ - remark            â”‚  å¤‡æ³¨è¯´æ˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â†“ ä½¿ç”¨
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   configs è¡¨        â”‚  ç³»ç»Ÿé…ç½®
â”‚ - config_key (PK)   â”‚  é…ç½®é”®
â”‚ - config_value      â”‚  é…ç½®å€¼ (JSON)
â”‚ - description       â”‚  é…ç½®è¯´æ˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ•°æ®åº“æ–‡ä»¶ä½ç½®**:
- SQLite: `data/devices.db`
- MySQL: æ ¹æ®é…ç½®è¿æ¥è¿œç¨‹æ•°æ®åº“

**ä¼˜åŠ¿**:
- æ”¯æŒå¤§è§„æ¨¡æ•°æ®ï¼ˆçº¦720æ¡çœŸå®è®¾å¤‡ï¼‰
- é«˜æ•ˆçš„æŸ¥è¯¢å’Œç´¢å¼•
- å®Œæ•´çš„ CRUD æ“ä½œ
- äº‹åŠ¡æ”¯æŒï¼Œä¿è¯æ•°æ®ä¸€è‡´æ€§
- æ”¯æŒå¹¶å‘è®¿é—®

### JSON æ–‡ä»¶æ¨¡å¼ï¼ˆå‘åå…¼å®¹ï¼‰

ä½¿ç”¨é™æ€ JSON æ–‡ä»¶å­˜å‚¨æ•°æ®ï¼Œé€‚åˆå°è§„æ¨¡æ•°æ®å’Œå¿«é€ŸåŸå‹ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ static_device.json  â”‚  è®¾å¤‡åŸºç¡€ä¿¡æ¯ï¼ˆ25ä¸ªç¤ºä¾‹è®¾å¤‡ï¼‰
â”‚ - device_id         â”‚  è®¾å¤‡å”¯ä¸€æ ‡è¯†
â”‚ - brand             â”‚  å“ç‰Œ
â”‚ - device_name       â”‚  è®¾å¤‡åç§°
â”‚ - spec_model        â”‚  è§„æ ¼å‹å·
â”‚ - detailed_params   â”‚  è¯¦ç»†å‚æ•°
â”‚ - unit_price        â”‚  ä¸å«ç¨å•ä»·
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â†“ å…³è”
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ static_rule.json    â”‚  åŒ¹é…è§„åˆ™ï¼ˆ25æ¡è§„åˆ™ï¼‰
â”‚ - rule_id           â”‚  è§„åˆ™å”¯ä¸€æ ‡è¯†
â”‚ - target_device_id  â”‚  å…³è”çš„è®¾å¤‡ID
â”‚ - auto_extracted_   â”‚  è‡ªåŠ¨æå–çš„ç‰¹å¾
â”‚   features          â”‚
â”‚ - feature_weights   â”‚  ç‰¹å¾æƒé‡æ˜ å°„
â”‚ - match_threshold   â”‚  åŒ¹é…é˜ˆå€¼
â”‚ - remark            â”‚  å¤‡æ³¨è¯´æ˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â†“ ä½¿ç”¨
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ static_config.json  â”‚  å…¨å±€é…ç½®
â”‚ - normalization_map â”‚  å½’ä¸€åŒ–æ˜ å°„è¡¨
â”‚ - feature_split_    â”‚  ç‰¹å¾æ‹†åˆ†ç¬¦å·
â”‚   chars              â”‚
â”‚ - ignore_keywords   â”‚  è¿‡æ»¤å…³é”®è¯
â”‚ - global_config     â”‚  å…¨å±€å‚æ•°
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ–‡ä»¶ä½ç½®**:
æ‰€æœ‰æ•°æ®æ–‡ä»¶ä½äº `data/` ç›®å½•ä¸‹ï¼š
- `data/static_device.json` - è®¾å¤‡è¡¨
- `data/static_rule.json` - è§„åˆ™è¡¨
- `data/static_config.json` - é…ç½®æ–‡ä»¶
- `data/ç¤ºä¾‹è®¾å¤‡æ¸…å•.xlsx` - ç¤ºä¾‹ Excel æ–‡ä»¶

**ä¼˜åŠ¿**:
- æ— éœ€æ•°æ®åº“é…ç½®
- æ˜“äºç‰ˆæœ¬æ§åˆ¶
- å¿«é€Ÿéƒ¨ç½²
- é€‚åˆå°è§„æ¨¡æ•°æ®

### å­˜å‚¨æ¨¡å¼åˆ‡æ¢

åœ¨ `backend/config.py` ä¸­é…ç½®å­˜å‚¨æ¨¡å¼ï¼š

```python
# æ•°æ®åº“æ¨¡å¼
STORAGE_MODE = 'database'
DATABASE_TYPE = 'sqlite'  # æˆ– 'mysql'
DATABASE_URL = 'sqlite:///data/devices.db'
FALLBACK_TO_JSON = True  # æ•°æ®åº“å¤±è´¥æ—¶è‡ªåŠ¨å›é€€

# JSON æ¨¡å¼
STORAGE_MODE = 'json'
```

### æ•°æ®å®Œæ•´æ€§

ç³»ç»Ÿå¯åŠ¨æ—¶ä¼šè‡ªåŠ¨æ ¡éªŒï¼š
1. æ‰€æœ‰è§„åˆ™çš„ `target_device_id` å¿…é¡»å­˜åœ¨äºè®¾å¤‡è¡¨ä¸­
2. è§„åˆ™çš„å¿…éœ€å­—æ®µä¸èƒ½ä¸ºç©º
3. è®¾å¤‡å’Œè§„åˆ™çš„ ID å¿…é¡»å”¯ä¸€
4. æ•°æ®åº“æ¨¡å¼ä¸‹ï¼Œå¤–é”®çº¦æŸè‡ªåŠ¨ä¿è¯å…³è”å®Œæ•´æ€§

## æ•°æ®åº“æ¨¡å¼ç»´æŠ¤

### æ•°æ®åº“åˆå§‹åŒ–

**é¦–æ¬¡è®¾ç½®æ•°æ®åº“**:

```bash
cd backend

# 1. åˆ›å»ºæ•°æ®åº“è¡¨ç»“æ„
python init_database.py

# 2. å¯¼å…¥çœŸå®è®¾å¤‡æ•°æ®ï¼ˆçº¦720æ¡ï¼‰
python import_devices_from_excel.py

# 3. è‡ªåŠ¨ç”ŸæˆåŒ¹é…è§„åˆ™
python generate_rules_for_devices.py
```

è¯¦ç»†è¯´æ˜è¯·å‚è€ƒ [DATABASE_SETUP.md](backend/DATABASE_SETUP.md)

### æ·»åŠ æ–°è®¾å¤‡

**æ–¹å¼ 1: é€šè¿‡ Excel æ‰¹é‡å¯¼å…¥**

```bash
# å‡†å¤‡ Excel æ–‡ä»¶ï¼ŒåŒ…å«ä»¥ä¸‹åˆ—ï¼š
# - å“ç‰Œ
# - è®¾å¤‡åç§°
# - è§„æ ¼å‹å·
# - è¯¦ç»†å‚æ•°
# - ä¸å«ç¨å•ä»·

python import_devices_from_excel.py --file your_devices.xlsx
```

**æ–¹å¼ 2: é€šè¿‡ SQL æ¨¡æ¿æ‰‹åŠ¨å¯¼å…¥**

ç¼–è¾‘ `backend/sql_templates/insert_devices.sql`:

```sql
INSERT INTO devices (device_id, brand, device_name, spec_model, detailed_params, unit_price)
VALUES
('SENSOR010', 'è¥¿é—¨å­', 'æµé‡ä¼ æ„Ÿå™¨', 'QVE2001', '0-10m/s,4-20mAè¾“å‡º', 1850.00),
('SENSOR011', 'éœå°¼éŸ¦å°”', 'å‹åŠ›ä¼ æ„Ÿå™¨', 'P7640B', '0-10bar,4-20mAè¾“å‡º', 1200.00);
```

ç„¶åæ‰§è¡Œï¼š

```bash
sqlite3 data/devices.db < backend/sql_templates/insert_devices.sql
```

**æ–¹å¼ 3: é€šè¿‡ Python ä»£ç **

```python
from modules.database import DatabaseManager
from modules.models import Device as DeviceModel

db_manager = DatabaseManager('sqlite:///data/devices.db')

with db_manager.session_scope() as session:
    new_device = DeviceModel(
        device_id='SENSOR010',
        brand='è¥¿é—¨å­',
        device_name='æµé‡ä¼ æ„Ÿå™¨',
        spec_model='QVE2001',
        detailed_params='0-10m/s,4-20mAè¾“å‡º,ç®¡é“å¼å®‰è£…',
        unit_price=1850.00
    )
    session.add(new_device)
```

### ä¿®æ”¹è®¾å¤‡ä¿¡æ¯

**é€šè¿‡ SQL**:

```bash
# ä¿®æ”¹ä»·æ ¼
sqlite3 data/devices.db "UPDATE devices SET unit_price = 800.00 WHERE device_id = 'SENSOR001';"

# ä¿®æ”¹å‚æ•°
sqlite3 data/devices.db "UPDATE devices SET detailed_params = '0-100PPM,4-20mA,å¸¦æ˜¾ç¤º' WHERE device_id = 'SENSOR001';"
```

**é€šè¿‡ Python**:

```python
from modules.database_loader import DatabaseLoader

loader = DatabaseLoader(db_manager)

# è·å–è®¾å¤‡
device = loader.get_device_by_id('SENSOR001')

# ä¿®æ”¹å±æ€§
device.unit_price = 800.00

# æ›´æ–°åˆ°æ•°æ®åº“
loader.update_device(device)
```

âš ï¸ **æ³¨æ„**: ä¿®æ”¹ `detailed_params` åéœ€è¦é‡æ–°ç”Ÿæˆè§„åˆ™ï¼

### åˆ é™¤è®¾å¤‡

```bash
# é€šè¿‡ SQLï¼ˆä¼šè‡ªåŠ¨çº§è”åˆ é™¤å…³è”çš„è§„åˆ™ï¼‰
sqlite3 data/devices.db "DELETE FROM devices WHERE device_id = 'SENSOR001';"
```

```python
# é€šè¿‡ Python
loader.delete_device('SENSOR001')
```

âš ï¸ **è­¦å‘Š**: åˆ é™¤è®¾å¤‡å‰è¯·ç¡®ä¿æ²¡æœ‰å†å²æŠ¥ä»·å•ä¾èµ–è¯¥è®¾å¤‡ã€‚

### æŸ¥è¯¢è®¾å¤‡

```bash
# æŸ¥çœ‹æ‰€æœ‰è®¾å¤‡
sqlite3 data/devices.db "SELECT * FROM devices;"

# æŒ‰å“ç‰ŒæŸ¥è¯¢
sqlite3 data/devices.db "SELECT * FROM devices WHERE brand = 'éœå°¼éŸ¦å°”';"

# æŒ‰ä»·æ ¼èŒƒå›´æŸ¥è¯¢
sqlite3 data/devices.db "SELECT * FROM devices WHERE unit_price BETWEEN 500 AND 1000;"

# ç»Ÿè®¡è®¾å¤‡æ•°é‡
sqlite3 data/devices.db "SELECT COUNT(*) FROM devices;"
```

### è§„åˆ™ç®¡ç†

**è‡ªåŠ¨ç”Ÿæˆè§„åˆ™**:

```bash
# ä¸ºæ‰€æœ‰æ²¡æœ‰è§„åˆ™çš„è®¾å¤‡ç”Ÿæˆè§„åˆ™
python generate_rules_for_devices.py

# ä¸ºç‰¹å®šè®¾å¤‡ç”Ÿæˆè§„åˆ™
python generate_rules_for_devices.py --device-id SENSOR010
```

**æ‰‹åŠ¨è°ƒæ•´è§„åˆ™**:

```bash
# æŸ¥çœ‹è§„åˆ™
sqlite3 data/devices.db "SELECT * FROM rules WHERE target_device_id = 'SENSOR001';"

# ä¿®æ”¹åŒ¹é…é˜ˆå€¼
sqlite3 data/devices.db "UPDATE rules SET match_threshold = 3.0 WHERE rule_id = 'R_SENSOR001';"
```

### æ•°æ®è¿ç§»

**ä» JSON è¿ç§»åˆ°æ•°æ®åº“**:

```bash
python migrate_json_to_db.py
```

è„šæœ¬ä¼šï¼š
1. è¯»å–æ‰€æœ‰ JSON æ–‡ä»¶
2. ä¿æŒè®¾å¤‡ ID å’Œè§„åˆ™ ID ä¸å˜
3. ä½¿ç”¨äº‹åŠ¡ç¡®ä¿æ•°æ®ä¸€è‡´æ€§
4. è¾“å‡ºè¿ç§»ç»Ÿè®¡ä¿¡æ¯

**ä»æ•°æ®åº“å¯¼å‡ºåˆ° JSON**:

```python
# åˆ›å»ºå¯¼å‡ºè„šæœ¬ export_db_to_json.py
from modules.database_loader import DatabaseLoader
import json

loader = DatabaseLoader(db_manager)

# å¯¼å‡ºè®¾å¤‡
devices = loader.load_devices()
with open('data/exported_devices.json', 'w', encoding='utf-8') as f:
    json.dump([d.__dict__ for d in devices.values()], f, ensure_ascii=False, indent=2)

# å¯¼å‡ºè§„åˆ™
rules = loader.load_rules()
with open('data/exported_rules.json', 'w', encoding='utf-8') as f:
    json.dump([r.__dict__ for r in rules], f, ensure_ascii=False, indent=2)
```

### æ•°æ®åº“å¤‡ä»½

**SQLite å¤‡ä»½**:

```bash
# å¤‡ä»½æ•°æ®åº“æ–‡ä»¶
cp data/devices.db data/backup/devices_$(date +%Y%m%d).db

# æˆ–ä½¿ç”¨ SQLite å‘½ä»¤
sqlite3 data/devices.db ".backup data/backup/devices_$(date +%Y%m%d).db"
```

**MySQL å¤‡ä»½**:

```bash
mysqldump -u username -p database_name > backup_$(date +%Y%m%d).sql
```

### æ•°æ®åº“æ€§èƒ½ä¼˜åŒ–

**åˆ›å»ºç´¢å¼•**:

```sql
-- ä¸ºå¸¸ç”¨æŸ¥è¯¢å­—æ®µåˆ›å»ºç´¢å¼•
CREATE INDEX idx_device_brand ON devices(brand);
CREATE INDEX idx_device_name ON devices(device_name);
CREATE INDEX idx_rule_device ON rules(target_device_id);
```

**æŸ¥çœ‹æŸ¥è¯¢è®¡åˆ’**:

```bash
sqlite3 data/devices.db "EXPLAIN QUERY PLAN SELECT * FROM devices WHERE brand = 'éœå°¼éŸ¦å°”';"
```

## JSONæ¨¡å¼ç»´æŠ¤

### è®¾å¤‡è¡¨ç»´æŠ¤

### è®¾å¤‡è¡¨ç»“æ„

```json
{
  "device_id": "SENSOR001",
  "brand": "éœå°¼éŸ¦å°”",
  "device_name": "COä¼ æ„Ÿå™¨",
  "spec_model": "HSCM-R100U",
  "detailed_params": "0-100PPM,4-20mA/0-10V/2-10Vä¿¡å·,æ— æ˜¾ç¤º,æ— ç»§ç”µå™¨è¾“å‡º",
  "unit_price": 766.14
}
```

### å­—æ®µè¯´æ˜

| å­—æ®µ | ç±»å‹ | å¿…å¡« | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|------|------|
| device_id | string | âœ… | è®¾å¤‡å”¯ä¸€æ ‡è¯†ï¼Œå»ºè®®ä½¿ç”¨ç±»å‹+åºå· | SENSOR001, CONTROLLER001 |
| brand | string | âœ… | è®¾å¤‡å“ç‰Œ | éœå°¼éŸ¦å°”, è¥¿é—¨å­, æ±Ÿæ£®è‡ªæ§ |
| device_name | string | âœ… | è®¾å¤‡åç§° | COä¼ æ„Ÿå™¨, DDCæ§åˆ¶å™¨ |
| spec_model | string | âœ… | è§„æ ¼å‹å· | HSCM-R100U, FX-PCV3624E |
| detailed_params | string | âœ… | è¯¦ç»†å‚æ•°ï¼Œç”¨é€—å·åˆ†éš” | 0-100PPM,4-20mA,æ— æ˜¾ç¤º |
| unit_price | number | âœ… | ä¸å«ç¨å•ä»·ï¼ˆå…ƒï¼‰ | 766.14 |

### æ·»åŠ æ–°è®¾å¤‡

**æ­¥éª¤ 1: ç¼–è¾‘è®¾å¤‡è¡¨**

åœ¨ `data/static_device.json` æ–‡ä»¶æœ«å°¾æ·»åŠ æ–°è®¾å¤‡ï¼š

```json
{
  "device_id": "SENSOR009",
  "brand": "è¥¿é—¨å­",
  "device_name": "æµé‡ä¼ æ„Ÿå™¨",
  "spec_model": "QVE2001",
  "detailed_params": "0-10m/s,4-20mAè¾“å‡º,ç®¡é“å¼å®‰è£…,å¸¦æ˜¾ç¤º",
  "unit_price": 1850.00
}
```

**æ­¥éª¤ 2: ç”ŸæˆåŒ¹é…è§„åˆ™**

è¿è¡Œè‡ªåŠ¨è§„åˆ™ç”Ÿæˆè„šæœ¬ï¼š

```bash
cd backend
python generate_rules.py
```

è„šæœ¬ä¼šè‡ªåŠ¨ï¼š
- ä¸ºæ–°è®¾å¤‡ç”ŸæˆåŒ¹é…è§„åˆ™
- æå–ç‰¹å¾å¹¶è®¾ç½®æƒé‡
- ä¿å­˜åˆ° `static_rule.json`

**æ­¥éª¤ 3: éªŒè¯æ•°æ®**

é‡å¯åç«¯æœåŠ¡ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨æ ¡éªŒæ•°æ®å®Œæ•´æ€§ï¼š

```bash
python app.py
```

æŸ¥çœ‹æ—¥å¿—ç¡®è®¤æ–°è®¾å¤‡å·²åŠ è½½ã€‚

### ä¿®æ”¹è®¾å¤‡ä¿¡æ¯

**ä¿®æ”¹ä»·æ ¼**:
```json
{
  "device_id": "SENSOR001",
  "unit_price": 800.00  // ä» 766.14 æ”¹ä¸º 800.00
}
```

**ä¿®æ”¹å‚æ•°**:
```json
{
  "device_id": "SENSOR001",
  "detailed_params": "0-100PPM,4-20mA/0-10Vä¿¡å·,å¸¦æ˜¾ç¤º"  // ä¿®æ”¹å‚æ•°
}
```

âš ï¸ **æ³¨æ„**: ä¿®æ”¹ `detailed_params` åéœ€è¦é‡æ–°ç”Ÿæˆè§„åˆ™ï¼

### åˆ é™¤è®¾å¤‡

1. ä» `static_device.json` ä¸­åˆ é™¤è®¾å¤‡æ¡ç›®
2. ä» `static_rule.json` ä¸­åˆ é™¤å¯¹åº”çš„è§„åˆ™
3. é‡å¯æœåŠ¡

âš ï¸ **è­¦å‘Š**: åˆ é™¤è®¾å¤‡å‰è¯·ç¡®ä¿æ²¡æœ‰å†å²æŠ¥ä»·å•ä¾èµ–è¯¥è®¾å¤‡ã€‚

## è§„åˆ™è¡¨ç»´æŠ¤

### è§„åˆ™è¡¨ç»“æ„

```json
{
  "rule_id": "R_SENSOR001",
  "target_device_id": "SENSOR001",
  "auto_extracted_features": [
    "éœå°¼éŸ¦å°”",
    "COä¼ æ„Ÿå™¨",
    "HSCM-R100U",
    "0-100ppm",
    "4-20ma"
  ],
  "feature_weights": {
    "éœå°¼éŸ¦å°”": 3.0,
    "COä¼ æ„Ÿå™¨": 2.5,
    "HSCM-R100U": 3.0,
    "0-100ppm": 1.0,
    "4-20ma": 1.0
  },
  "match_threshold": 2,
  "remark": "è‡ªåŠ¨ç”Ÿæˆçš„è§„åˆ™ - éœå°¼éŸ¦å°” COä¼ æ„Ÿå™¨"
}
```

### å­—æ®µè¯´æ˜

| å­—æ®µ | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| rule_id | string | âœ… | è§„åˆ™å”¯ä¸€æ ‡è¯†ï¼Œå»ºè®®ä½¿ç”¨ R_ + device_id |
| target_device_id | string | âœ… | å…³è”çš„è®¾å¤‡IDï¼Œå¿…é¡»å­˜åœ¨äºè®¾å¤‡è¡¨ |
| auto_extracted_features | array | âœ… | è‡ªåŠ¨æå–çš„ç‰¹å¾åˆ—è¡¨ |
| feature_weights | object | âœ… | ç‰¹å¾æƒé‡æ˜ å°„è¡¨ |
| match_threshold | number | âœ… | åŒ¹é…é˜ˆå€¼ï¼Œå»ºè®® 2-5 |
| remark | string | âŒ | å¤‡æ³¨è¯´æ˜ |

### è°ƒæ•´ç‰¹å¾æƒé‡

æƒé‡å†³å®šäº†ç‰¹å¾åœ¨åŒ¹é…ä¸­çš„é‡è¦æ€§ï¼š

**æƒé‡å»ºè®®**:
- **å“ç‰Œ**: 3.0ï¼ˆé«˜æƒé‡ï¼Œå“ç‰ŒåŒ¹é…å¾ˆé‡è¦ï¼‰
- **å‹å·**: 3.0ï¼ˆé«˜æƒé‡ï¼Œå‹å·æ˜¯å…³é”®æ ‡è¯†ï¼‰
- **è®¾å¤‡ç±»å‹**: 2.5ï¼ˆä¸­é«˜æƒé‡ï¼‰
- **å‚æ•°ç‰¹å¾**: 1.0-2.0ï¼ˆä¸­ä½æƒé‡ï¼‰
- **å¯é€‰ç‰¹å¾**: 0.5-1.0ï¼ˆä½æƒé‡ï¼‰

**ç¤ºä¾‹ï¼šæé«˜æŸä¸ªç‰¹å¾çš„æƒé‡**

```json
{
  "feature_weights": {
    "éœå°¼éŸ¦å°”": 3.0,
    "HSCM-R100U": 3.0,
    "0-100ppm": 2.0,  // ä» 1.0 æé«˜åˆ° 2.0
    "4-20ma": 1.0
  }
}
```

### è°ƒæ•´åŒ¹é…é˜ˆå€¼

é˜ˆå€¼å†³å®šäº†åŒ¹é…çš„ä¸¥æ ¼ç¨‹åº¦ï¼š

- **é˜ˆå€¼è¿‡ä½** (< 2): å®¹æ˜“è¯¯åŒ¹é…ï¼Œå‡†ç¡®ç‡ä¸‹é™
- **é˜ˆå€¼é€‚ä¸­** (2-5): å¹³è¡¡å‡†ç¡®ç‡å’Œå¬å›ç‡
- **é˜ˆå€¼è¿‡é«˜** (> 5): åŒ¹é…è¿‡äºä¸¥æ ¼ï¼Œå¾ˆå¤šè®¾å¤‡åŒ¹é…å¤±è´¥

**è°ƒæ•´å»ºè®®**:

```json
{
  "match_threshold": 3  // ä» 2 æé«˜åˆ° 3ï¼Œæ›´ä¸¥æ ¼
}
```

### æ·»åŠ è‡ªå®šä¹‰ç‰¹å¾

å¦‚æœè‡ªåŠ¨æå–çš„ç‰¹å¾ä¸å¤Ÿï¼Œå¯ä»¥æ‰‹åŠ¨æ·»åŠ ï¼š

```json
{
  "auto_extracted_features": [
    "éœå°¼éŸ¦å°”",
    "COä¼ æ„Ÿå™¨",
    "HSCM-R100U",
    "0-100ppm",
    "4-20ma",
    "ç”µåŒ–å­¦å¼"  // æ‰‹åŠ¨æ·»åŠ çš„ç‰¹å¾
  ],
  "feature_weights": {
    "éœå°¼éŸ¦å°”": 3.0,
    "COä¼ æ„Ÿå™¨": 2.5,
    "HSCM-R100U": 3.0,
    "0-100ppm": 1.0,
    "4-20ma": 1.0,
    "ç”µåŒ–å­¦å¼": 1.5  // ä¸ºæ–°ç‰¹å¾è®¾ç½®æƒé‡
  }
}
```

### è§„åˆ™ä¼˜åŒ–æŠ€å·§

**æŠ€å·§ 1: ä½¿ç”¨å½’ä¸€åŒ–åçš„ç‰¹å¾**

ç‰¹å¾åº”è¯¥ä½¿ç”¨å½’ä¸€åŒ–åçš„æ ¼å¼ï¼ˆå°å†™ã€æ— ç©ºæ ¼ï¼‰ï¼š
- âœ… "0-100ppm"
- âŒ "0~100PPM"

**æŠ€å·§ 2: é¿å…è¿‡äºé€šç”¨çš„ç‰¹å¾**

ä¸è¦ä½¿ç”¨è¿‡äºé€šç”¨çš„ç‰¹å¾ï¼Œä¼šå¯¼è‡´è¯¯åŒ¹é…ï¼š
- âŒ "ä¼ æ„Ÿå™¨"ï¼ˆå¤ªé€šç”¨ï¼‰
- âœ… "COä¼ æ„Ÿå™¨"ï¼ˆæ›´å…·ä½“ï¼‰

**æŠ€å·§ 3: å¹³è¡¡ç‰¹å¾æ•°é‡**

- ç‰¹å¾å¤ªå°‘ï¼šåŒ¹é…ä¸å‡†ç¡®
- ç‰¹å¾å¤ªå¤šï¼šéš¾ä»¥åŒ¹é…æˆåŠŸ
- å»ºè®®ï¼š5-10 ä¸ªç‰¹å¾

## é…ç½®æ–‡ä»¶ç®¡ç†

### é…ç½®æ–‡ä»¶ç»“æ„

```json
{
  "normalization_map": { ... },
  "feature_split_chars": [ ... ],
  "ignore_keywords": [ ... ],
  "global_config": { ... },
  "ui_config": { ... },
  "performance_config": { ... }
}
```

### å½’ä¸€åŒ–æ˜ å°„è¡¨

ç”¨äºç»Ÿä¸€ä¸åŒçš„è¡¨è¾¾æ–¹å¼ï¼š

```json
{
  "normalization_map": {
    "~": "-",
    "ï½": "-",
    "â„ƒ": "æ‘„æ°åº¦",
    "PPM": "ppm",
    "VDC": "V"
  }
}
```

**æ·»åŠ æ–°æ˜ å°„**:

```json
{
  "normalization_map": {
    "ç±³/ç§’": "m/s",  // æ–°å¢æ˜ å°„
    "å…¬æ–¤": "kg"     // æ–°å¢æ˜ å°„
  }
}
```

### ç‰¹å¾æ‹†åˆ†ç¬¦å·

å®šä¹‰å“ªäº›ç¬¦å·ç”¨äºæ‹†åˆ†ç‰¹å¾ï¼š

```json
{
  "feature_split_chars": [",", ";", "ï¼Œ", "ï¼›", "ï¼š", ":", "/", "ã€"]
}
```

**æ·»åŠ æ–°åˆ†éš”ç¬¦**:

```json
{
  "feature_split_chars": [",", ";", "ï¼Œ", "ï¼›", "ï¼š", ":", "/", "ã€", "|", "\\"]
}
```

### è¿‡æ»¤å…³é”®è¯

å®šä¹‰éœ€è¦ä»è®¾å¤‡æè¿°ä¸­åˆ é™¤çš„å…³é”®è¯ï¼š

```json
{
  "ignore_keywords": [
    "æ–½å·¥è¦æ±‚",
    "éªŒæ”¶",
    "å›¾çº¸",
    "è§„èŒƒ",
    "æ¸…å•"
  ]
}
```

**æ·»åŠ æ–°å…³é”®è¯**:

```json
{
  "ignore_keywords": [
    "æ–½å·¥è¦æ±‚",
    "éªŒæ”¶",
    "å«ç¨",      // æ–°å¢
    "ä¸å«ç¨",    // æ–°å¢
    "å“ç‰Œ"       // æ–°å¢
  ]
}
```

### å…¨å±€é…ç½®

```json
{
  "global_config": {
    "default_match_threshold": 2,    // é»˜è®¤åŒ¹é…é˜ˆå€¼
    "unify_lowercase": true,         // ç»Ÿä¸€å°å†™
    "remove_whitespace": true,       // åˆ é™¤ç©ºæ ¼
    "fullwidth_to_halfwidth": true   // å…¨è§’è½¬åŠè§’
  }
}
```

**è°ƒæ•´é»˜è®¤é˜ˆå€¼**:

```json
{
  "global_config": {
    "default_match_threshold": 3  // ä» 2 æé«˜åˆ° 3
  }
}
```

### UIé…ç½®

æ§åˆ¶å‰ç«¯ç•Œé¢çš„è¡Œä¸ºå’Œé™åˆ¶ï¼š

```json
{
  "ui_config": {
    "max_file_size_mb": 10,           // æœ€å¤§ä¸Šä¼ æ–‡ä»¶å¤§å°ï¼ˆMBï¼‰
    "supported_formats": [             // æ”¯æŒçš„æ–‡ä»¶æ ¼å¼
      "xls",
      "xlsm",
      "xlsx"
    ],
    "default_export_format": "xlsx"   // é»˜è®¤å¯¼å‡ºæ ¼å¼
  }
}
```

**å­—æ®µè¯´æ˜**ï¼š

| å­—æ®µ | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| max_file_size_mb | number | 10 | ä¸Šä¼ æ–‡ä»¶å¤§å°é™åˆ¶ï¼ˆMBï¼‰ï¼Œè¶…è¿‡æ­¤å¤§å°çš„æ–‡ä»¶å°†è¢«æ‹’ç» |
| supported_formats | array | ["xls", "xlsm", "xlsx"] | æ”¯æŒçš„Excelæ–‡ä»¶æ ¼å¼åˆ—è¡¨ |
| default_export_format | string | "xlsx" | å¯¼å‡ºæŠ¥ä»·å•æ—¶çš„é»˜è®¤æ–‡ä»¶æ ¼å¼ |

**è°ƒæ•´ç¤ºä¾‹**ï¼š

```json
{
  "ui_config": {
    "max_file_size_mb": 20,           // æé«˜åˆ°20MB
    "supported_formats": [
      "xls",
      "xlsm",
      "xlsx",
      "csv"                            // æ·»åŠ CSVæ”¯æŒ
    ],
    "default_export_format": "xlsx"
  }
}
```

### æ€§èƒ½é…ç½®

æ§åˆ¶ç³»ç»Ÿæ€§èƒ½å’Œè¶…æ—¶è®¾ç½®ï¼š

```json
{
  "performance_config": {
    "parse_timeout_seconds": 5,       // Excelè§£æè¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰
    "match_timeout_seconds": 10,      // è®¾å¤‡åŒ¹é…è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰
    "max_rows_per_file": 10000        // å•ä¸ªæ–‡ä»¶æœ€å¤§è¡Œæ•°
  }
}
```

**å­—æ®µè¯´æ˜**ï¼š

| å­—æ®µ | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| parse_timeout_seconds | number | 5 | Excelæ–‡ä»¶è§£æçš„è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰ï¼Œè¶…æ—¶å°†ä¸­æ­¢è§£æ |
| match_timeout_seconds | number | 10 | è®¾å¤‡åŒ¹é…çš„è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰ï¼Œè¶…æ—¶å°†è¿”å›éƒ¨åˆ†ç»“æœ |
| max_rows_per_file | number | 10000 | å•ä¸ªExcelæ–‡ä»¶å…è®¸çš„æœ€å¤§è¡Œæ•°ï¼Œè¶…è¿‡å°†è¢«æ‹’ç» |

**æ€§èƒ½ä¼˜åŒ–å»ºè®®**ï¼š

1. **å°æ–‡ä»¶å¿«é€Ÿå¤„ç†**ï¼š
   ```json
   {
     "performance_config": {
       "parse_timeout_seconds": 3,
       "match_timeout_seconds": 5,
       "max_rows_per_file": 1000
     }
   }
   ```

2. **å¤§æ–‡ä»¶å¤„ç†**ï¼š
   ```json
   {
     "performance_config": {
       "parse_timeout_seconds": 30,
       "match_timeout_seconds": 60,
       "max_rows_per_file": 50000
     }
   }
   ```

3. **é«˜æ€§èƒ½æœåŠ¡å™¨**ï¼š
   ```json
   {
     "performance_config": {
       "parse_timeout_seconds": 10,
       "match_timeout_seconds": 20,
       "max_rows_per_file": 100000
     }
   }
   ```

**æ³¨æ„äº‹é¡¹**ï¼š

- è¶…æ—¶æ—¶é—´è¿‡çŸ­å¯èƒ½å¯¼è‡´å¤§æ–‡ä»¶å¤„ç†å¤±è´¥
- è¶…æ—¶æ—¶é—´è¿‡é•¿å¯èƒ½å¯¼è‡´ç³»ç»Ÿå“åº”ç¼“æ…¢
- max_rows_per_file åº”æ ¹æ®æœåŠ¡å™¨å†…å­˜è®¾ç½®
- å»ºè®®æ ¹æ®å®é™…ä¸šåŠ¡éœ€æ±‚å’ŒæœåŠ¡å™¨æ€§èƒ½è°ƒæ•´

**ç›‘æ§æ€§èƒ½æŒ‡æ ‡**ï¼š

```python
# æŸ¥çœ‹å¹³å‡å¤„ç†æ—¶é—´
import time

start = time.time()
# æ‰§è¡Œè§£ææˆ–åŒ¹é…
elapsed = time.time() - start

if elapsed > performance_config['parse_timeout_seconds']:
    logger.warning(f"å¤„ç†æ—¶é—´ {elapsed}ç§’ è¶…è¿‡é…ç½®çš„è¶…æ—¶æ—¶é—´")
```

## æ•…éšœæ’æŸ¥

### å¸¸è§é—®é¢˜

#### 1. æ•°æ®åº“è¿æ¥å¤±è´¥

**ç—‡çŠ¶**: ç³»ç»Ÿå¯åŠ¨æ—¶æŠ¥æ•°æ®åº“è¿æ¥é”™è¯¯

**å¯èƒ½åŸå› **:
- æ•°æ®åº“æ–‡ä»¶ä¸å­˜åœ¨
- æ•°æ®åº“æ–‡ä»¶æƒé™ä¸è¶³
- MySQL è¿æ¥é…ç½®é”™è¯¯
- æ•°æ®åº“æ–‡ä»¶æŸå

**è§£å†³æ–¹æ¡ˆ**:

**æ–¹æ¡ˆ 1: æ£€æŸ¥æ•°æ®åº“æ–‡ä»¶**
```bash
# æ£€æŸ¥ SQLite æ–‡ä»¶æ˜¯å¦å­˜åœ¨
ls -l data/devices.db

# æ£€æŸ¥æ–‡ä»¶æƒé™
chmod 644 data/devices.db
```

**æ–¹æ¡ˆ 2: é‡æ–°åˆå§‹åŒ–æ•°æ®åº“**
```bash
# å¤‡ä»½ç°æœ‰æ•°æ®åº“
cp data/devices.db data/devices.db.backup

# é‡æ–°åˆå§‹åŒ–
python init_database.py
```

**æ–¹æ¡ˆ 3: ä½¿ç”¨è‡ªåŠ¨å›é€€**
```python
# åœ¨ config.py ä¸­å¯ç”¨è‡ªåŠ¨å›é€€
FALLBACK_TO_JSON = True
```

ç³»ç»Ÿä¼šè‡ªåŠ¨åˆ‡æ¢åˆ° JSON æ¨¡å¼å¹¶è®°å½•æ—¥å¿—ã€‚

**æ–¹æ¡ˆ 4: æ£€æŸ¥ MySQL è¿æ¥**
```bash
# æµ‹è¯• MySQL è¿æ¥
mysql -h hostname -u username -p database_name
```

#### 2. åŒ¹é…å‡†ç¡®ç‡ä½

**ç—‡çŠ¶**: å¾ˆå¤šè®¾å¤‡åŒ¹é…å¤±è´¥æˆ–åŒ¹é…é”™è¯¯

**å¯èƒ½åŸå› **:
- è®¾å¤‡æè¿°æ ¼å¼ä¸è§„èŒƒ
- è§„åˆ™ç‰¹å¾ä¸å¤Ÿå‡†ç¡®
- åŒ¹é…é˜ˆå€¼è®¾ç½®ä¸å½“
- å½’ä¸€åŒ–æ˜ å°„ä¸å®Œæ•´

**è§£å†³æ–¹æ¡ˆ**:

**æ–¹æ¡ˆ 1: æ£€æŸ¥è®¾å¤‡æè¿°**
```bash
# æŸ¥çœ‹è§£ææ—¥å¿—
tail -f backend/logs/app.log | grep "preprocessed"
```

**æ–¹æ¡ˆ 2: è°ƒæ•´è§„åˆ™**
- é™ä½åŒ¹é…é˜ˆå€¼ï¼ˆä» 3 é™åˆ° 2ï¼‰
- å¢åŠ ç‰¹å¾æƒé‡
- æ·»åŠ æ›´å¤šç‰¹å¾

**æ–¹æ¡ˆ 3: å®Œå–„å½’ä¸€åŒ–æ˜ å°„**
```json
{
  "normalization_map": {
    "æ–°å‘ç°çš„ç¬¦å·": "æ ‡å‡†ç¬¦å·"
  }
}
```

#### 2. æ–‡ä»¶ä¸Šä¼ å¤±è´¥

**ç—‡çŠ¶**: ä¸Šä¼  Excel æ–‡ä»¶æ—¶æŠ¥é”™

**å¯èƒ½åŸå› **:
- æ–‡ä»¶æ ¼å¼ä¸æ”¯æŒ
- æ–‡ä»¶å¤§å°è¶…é™
- æ–‡ä»¶æŸå
- ä¸´æ—¶ç›®å½•æƒé™ä¸è¶³

**è§£å†³æ–¹æ¡ˆ**:

**æ–¹æ¡ˆ 1: æ£€æŸ¥æ–‡ä»¶æ ¼å¼**
```bash
# æŸ¥çœ‹æ–‡ä»¶æ‰©å±•å
file uploaded_file.xlsx
```

**æ–¹æ¡ˆ 2: æ£€æŸ¥æ–‡ä»¶å¤§å°**
```bash
# æŸ¥çœ‹æ–‡ä»¶å¤§å°
ls -lh uploaded_file.xlsx
```

**æ–¹æ¡ˆ 3: æ£€æŸ¥ä¸´æ—¶ç›®å½•**
```bash
# ç¡®ä¿ä¸´æ—¶ç›®å½•å­˜åœ¨ä¸”æœ‰å†™æƒé™
mkdir -p backend/temp/uploads
chmod 755 backend/temp/uploads
```

#### 3. å¯¼å‡ºæ–‡ä»¶æ ¼å¼é”™è¯¯

**ç—‡çŠ¶**: å¯¼å‡ºçš„ Excel æ–‡ä»¶æ ¼å¼ä¸æ­£ç¡®

**å¯èƒ½åŸå› **:
- åŸæ–‡ä»¶åˆå¹¶å•å…ƒæ ¼é…ç½®å¤æ‚
- openpyxl ç‰ˆæœ¬ä¸å…¼å®¹
- å†…å­˜ä¸è¶³

**è§£å†³æ–¹æ¡ˆ**:

**æ–¹æ¡ˆ 1: æ£€æŸ¥ openpyxl ç‰ˆæœ¬**
```bash
pip show openpyxl
# ç¡®ä¿ç‰ˆæœ¬ >= 3.0.0
```

**æ–¹æ¡ˆ 2: æŸ¥çœ‹é”™è¯¯æ—¥å¿—**
```bash
tail -f backend/logs/app.log | grep "export"
```

**æ–¹æ¡ˆ 3: ç®€åŒ–åŸæ–‡ä»¶**
- å‡å°‘åˆå¹¶å•å…ƒæ ¼
- åˆ é™¤å¤æ‚æ ¼å¼
- ä½¿ç”¨æ ‡å‡† Excel æ ¼å¼

#### 4. ç³»ç»Ÿå¯åŠ¨å¤±è´¥

**ç—‡çŠ¶**: åç«¯æœåŠ¡æ— æ³•å¯åŠ¨

**å¯èƒ½åŸå› **:
- ä¾èµ–åŒ…æœªå®‰è£…
- æ•°æ®æ–‡ä»¶æ ¼å¼é”™è¯¯
- ç«¯å£è¢«å ç”¨
- Python ç‰ˆæœ¬ä¸å…¼å®¹

**è§£å†³æ–¹æ¡ˆ**:

**æ–¹æ¡ˆ 1: æ£€æŸ¥ä¾èµ–**
```bash
pip install -r requirements.txt
```

**æ–¹æ¡ˆ 2: éªŒè¯æ•°æ®æ–‡ä»¶**
```bash
python -m json.tool data/static_device.json
python -m json.tool data/static_rule.json
python -m json.tool data/static_config.json
```

**æ–¹æ¡ˆ 3: æ£€æŸ¥ç«¯å£**
```bash
# Windows
netstat -ano | findstr :5000

# Linux/Mac
lsof -i :5000
```

**æ–¹æ¡ˆ 4: æ£€æŸ¥ Python ç‰ˆæœ¬**
```bash
python --version
# ç¡®ä¿ >= 3.8
```

## è‡ªåŠ¨åŒ–å·¥å…·

### è§„åˆ™ç”Ÿæˆè„šæœ¬

`generate_rules.py` ç”¨äºè‡ªåŠ¨ç”ŸæˆåŒ¹é…è§„åˆ™ã€‚

**ä½¿ç”¨æ–¹æ³•**:

```bash
python generate_rules.py
```

**åŠŸèƒ½**:
1. è¯»å–è®¾å¤‡è¡¨
2. ä¸ºæ¯ä¸ªè®¾å¤‡æå–ç‰¹å¾
3. è®¾ç½®é»˜è®¤æƒé‡
4. ç”Ÿæˆè§„åˆ™å¹¶ä¿å­˜

### æ•°æ®æ ¡éªŒè„šæœ¬

åˆ›å»º `validate_data.py` ç”¨äºæ ¡éªŒæ•°æ®å®Œæ•´æ€§ï¼š

```python
import json

def validate_data():
    # åŠ è½½æ•°æ®
    with open('data/static_device.json', 'r', encoding='utf-8') as f:
        devices = json.load(f)
    
    with open('data/static_rule.json', 'r', encoding='utf-8') as f:
        rules = json.load(f)
    
    # æ ¡éªŒè®¾å¤‡IDå”¯ä¸€æ€§
    device_ids = [d['device_id'] for d in devices]
    if len(device_ids) != len(set(device_ids)):
        print("âŒ è®¾å¤‡IDå­˜åœ¨é‡å¤")
        return False
    
    # æ ¡éªŒè§„åˆ™å…³è”
    for rule in rules:
        if rule['target_device_id'] not in device_ids:
            print(f"âŒ è§„åˆ™ {rule['rule_id']} å…³è”çš„è®¾å¤‡ä¸å­˜åœ¨")
            return False
    
    print("âœ… æ•°æ®æ ¡éªŒé€šè¿‡")
    return True

if __name__ == '__main__':
    validate_data()
```

**è¿è¡Œæ ¡éªŒ**:

```bash
python validate_data.py
```

## æœ€ä½³å®è·µ

### æ•°æ®ç®¡ç†

1. **å®šæœŸå¤‡ä»½**
   ```bash
   # å¤‡ä»½æ•°æ®æ–‡ä»¶
   cp data/static_device.json data/backup/static_device_$(date +%Y%m%d).json
   cp data/static_rule.json data/backup/static_rule_$(date +%Y%m%d).json
   ```

2. **ç‰ˆæœ¬æ§åˆ¶**
   - ä½¿ç”¨ Git ç®¡ç†æ•°æ®æ–‡ä»¶
   - æ¯æ¬¡ä¿®æ”¹éƒ½æäº¤å¹¶æ·»åŠ è¯´æ˜
   - ä½¿ç”¨åˆ†æ”¯æµ‹è¯•æ–°é…ç½®

3. **æ–‡æ¡£è®°å½•**
   - è®°å½•æ¯æ¬¡ä¿®æ”¹çš„åŸå› 
   - è®°å½•ç‰¹æ®Šè§„åˆ™çš„è¯´æ˜
   - ç»´æŠ¤è®¾å¤‡æ¸…å•

### è§„åˆ™ä¼˜åŒ–

1. **æ¸è¿›å¼è°ƒæ•´**
   - å…ˆè°ƒæ•´å•ä¸ªè§„åˆ™
   - æµ‹è¯•æ•ˆæœåå†æ‰¹é‡åº”ç”¨
   - è®°å½•è°ƒæ•´å‰åçš„å‡†ç¡®ç‡

2. **A/B æµ‹è¯•**
   - ä¿ç•™æ—§è§„åˆ™ä½œä¸ºå¯¹ç…§
   - å¯¹æ¯”æ–°æ—§è§„åˆ™çš„æ•ˆæœ
   - é€‰æ‹©æ•ˆæœæ›´å¥½çš„è§„åˆ™

3. **æŒç»­ç›‘æ§**
   - å®šæœŸæ£€æŸ¥åŒ¹é…å‡†ç¡®ç‡
   - æ”¶é›†ç”¨æˆ·åé¦ˆ
   - åŠæ—¶è°ƒæ•´è§„åˆ™

### é…ç½®ç®¡ç†

1. **ç¯å¢ƒéš”ç¦»**
   - å¼€å‘ç¯å¢ƒä½¿ç”¨æµ‹è¯•é…ç½®
   - ç”Ÿäº§ç¯å¢ƒä½¿ç”¨æ­£å¼é…ç½®
   - ä¸è¦ç›´æ¥ä¿®æ”¹ç”Ÿäº§é…ç½®

2. **é…ç½®éªŒè¯**
   - ä¿®æ”¹é…ç½®åå…ˆåœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯
   - ç¡®è®¤æ— è¯¯åå†åº”ç”¨åˆ°ç”Ÿäº§
   - ä¿ç•™é…ç½®ä¿®æ”¹è®°å½•

3. **çƒ­åŠ è½½æ”¯æŒ**
   - ç³»ç»Ÿæ”¯æŒé…ç½®çƒ­åŠ è½½
   - ä¿®æ”¹é…ç½®åæ— éœ€é‡å¯
   - ä½†å»ºè®®é‡è¦ä¿®æ”¹åé‡å¯æœåŠ¡

### æµ‹è¯•æµç¨‹

1. **å•å…ƒæµ‹è¯•**
   ```bash
   # è¿è¡Œæ‰€æœ‰æµ‹è¯•
   pytest tests/ -v
   
   # è¿è¡Œç‰¹å®šæ¨¡å—æµ‹è¯•
   pytest tests/test_match_engine.py -v
   ```

2. **é›†æˆæµ‹è¯•**
   ```bash
   # æµ‹è¯•å®Œæ•´æµç¨‹
   pytest tests/test_integration_e2e.py -v
   ```

3. **æ‰‹åŠ¨æµ‹è¯•**
   - ä½¿ç”¨ç¤ºä¾‹ Excel æ–‡ä»¶æµ‹è¯•
   - æµ‹è¯•å„ç§è¾¹ç•Œæƒ…å†µ
   - éªŒè¯å¯¼å‡ºæ–‡ä»¶æ ¼å¼

### ç›‘æ§æŒ‡æ ‡

å®šæœŸæ£€æŸ¥ä»¥ä¸‹æŒ‡æ ‡ï¼š

1. **åŒ¹é…å‡†ç¡®ç‡**: ç›®æ ‡ â‰¥ 85%
2. **è§£ææ€§èƒ½**: 1000 è¡Œ â‰¤ 5 ç§’
3. **åŒ¹é…æ€§èƒ½**: 1000 ä¸ªè®¾å¤‡ â‰¤ 10 ç§’
4. **é”™è¯¯ç‡**: ç›®æ ‡ < 5%

### ç”¨æˆ·åŸ¹è®­

1. **æ“ä½œåŸ¹è®­**
   - å¦‚ä½•ä¸Šä¼ æ–‡ä»¶
   - å¦‚ä½•æ‰‹åŠ¨è°ƒæ•´åŒ¹é…
   - å¦‚ä½•å¯¼å‡ºæŠ¥ä»·å•

2. **æ•°æ®ç»´æŠ¤åŸ¹è®­**
   - å¦‚ä½•æ·»åŠ æ–°è®¾å¤‡
   - å¦‚ä½•è°ƒæ•´è§„åˆ™
   - å¦‚ä½•ä¼˜åŒ–é…ç½®

3. **æ•…éšœå¤„ç†åŸ¹è®­**
   - å¸¸è§é—®é¢˜æ’æŸ¥
   - æ—¥å¿—æŸ¥çœ‹æ–¹æ³•
   - è”ç³»æŠ€æœ¯æ”¯æŒ

## è”ç³»æ”¯æŒ

å¦‚é‡åˆ°æ— æ³•è§£å†³çš„é—®é¢˜ï¼Œè¯·è”ç³»æŠ€æœ¯æ”¯æŒï¼š

- ğŸ“§ é‚®ç®±: support@example.com
- ğŸ“ ç”µè¯: 400-xxx-xxxx
- ğŸ’¬ åœ¨çº¿æ”¯æŒ: https://support.example.com

æä¾›ä»¥ä¸‹ä¿¡æ¯ä»¥ä¾¿å¿«é€Ÿå®šä½é—®é¢˜ï¼š
1. é”™è¯¯æˆªå›¾æˆ–æ—¥å¿—
2. æ“ä½œæ­¥éª¤
3. ç³»ç»Ÿç‰ˆæœ¬ä¿¡æ¯
4. æ•°æ®æ–‡ä»¶ï¼ˆå¦‚æ¶‰åŠï¼‰

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0.0  
**æœ€åæ›´æ–°**: 2024-02  
**ç»´æŠ¤è€…**: DDC ç³»ç»Ÿå¼€å‘å›¢é˜Ÿ


---

## æ•°æ®åº“ç»´æŠ¤è¡¥å……è¯´æ˜

### æ•°æ®åº“å¥åº·æ£€æŸ¥

**æ£€æŸ¥æ•°æ®åº“å®Œæ•´æ€§**:

```bash
# SQLite å®Œæ•´æ€§æ£€æŸ¥
sqlite3 data/devices.db "PRAGMA integrity_check;"

# æ£€æŸ¥è¡¨ç»“æ„
sqlite3 data/devices.db ".schema"

# æ£€æŸ¥æ•°æ®ç»Ÿè®¡
sqlite3 data/devices.db "
SELECT 
  (SELECT COUNT(*) FROM devices) as device_count,
  (SELECT COUNT(*) FROM rules) as rule_count,
  (SELECT COUNT(*) FROM configs) as config_count;
"
```

### æ•°æ®åº“æ€§èƒ½ç›‘æ§

**æŸ¥è¯¢æ€§èƒ½åˆ†æ**:

```bash
# å¯ç”¨æŸ¥è¯¢æ—¥å¿—
sqlite3 data/devices.db "PRAGMA query_only = ON;"

# åˆ†ææ…¢æŸ¥è¯¢
sqlite3 data/devices.db "EXPLAIN QUERY PLAN SELECT * FROM devices WHERE brand = 'éœå°¼éŸ¦å°”';"
```

**ä¼˜åŒ–å»ºè®®**:
1. ä¸ºå¸¸ç”¨æŸ¥è¯¢å­—æ®µåˆ›å»ºç´¢å¼•
2. å®šæœŸæ‰§è¡Œ VACUUM æ¸…ç†ç¢ç‰‡
3. ä½¿ç”¨äº‹åŠ¡æ‰¹é‡æ“ä½œ
4. é¿å…åœ¨å¾ªç¯ä¸­æ‰§è¡ŒæŸ¥è¯¢

### æ•°æ®åº“æ•…éšœæ¢å¤

**SQLite æ•°æ®åº“æŸå**:

```bash
# å°è¯•æ¢å¤
sqlite3 data/devices.db ".recover" | sqlite3 data/devices_recovered.db

# å¦‚æœæ— æ³•æ¢å¤ï¼Œä»å¤‡ä»½è¿˜åŸ
cp data/backup/devices_20260212.db data/devices.db
```

**æ•°æ®ä¸¢å¤±æ¢å¤**:

1. ä»æœ€è¿‘çš„å¤‡ä»½è¿˜åŸ
2. å¦‚æœæœ‰ JSON å¤‡ä»½ï¼Œé‡æ–°è¿ç§»
3. ä» Excel é‡æ–°å¯¼å…¥è®¾å¤‡æ•°æ®

### æ•°æ®åº“å‡çº§å’Œè¿ç§»

**ä» SQLite è¿ç§»åˆ° MySQL**:

```bash
# 1. å¯¼å‡º SQLite æ•°æ®
sqlite3 data/devices.db .dump > devices_dump.sql

# 2. è½¬æ¢ SQL è¯­æ³•ï¼ˆSQLite -> MySQLï¼‰
# ç¼–è¾‘ devices_dump.sqlï¼Œè°ƒæ•´è¯­æ³•å·®å¼‚

# 3. å¯¼å…¥åˆ° MySQL
mysql -u username -p database_name < devices_dump.sql

# 4. æ›´æ–°é…ç½®
# åœ¨ config.py ä¸­ä¿®æ”¹ DATABASE_TYPE å’Œ DATABASE_URL
```

### æ•°æ®åº“å®‰å…¨

**æƒé™ç®¡ç†**:

```bash
# è®¾ç½®æ•°æ®åº“æ–‡ä»¶æƒé™
chmod 640 data/devices.db
chown app_user:app_group data/devices.db
```

**å¤‡ä»½ç­–ç•¥**:

1. æ¯æ—¥è‡ªåŠ¨å¤‡ä»½
2. ä¿ç•™æœ€è¿‘7å¤©çš„å¤‡ä»½
3. æ¯å‘¨å®Œæ•´å¤‡ä»½
4. å¼‚åœ°å¤‡ä»½é‡è¦æ•°æ®

**å¤‡ä»½è„šæœ¬ç¤ºä¾‹**:

```bash
#!/bin/bash
# backup_database.sh

BACKUP_DIR="data/backup"
DATE=$(date +%Y%m%d_%H%M%S)
DB_FILE="data/devices.db"

# åˆ›å»ºå¤‡ä»½ç›®å½•
mkdir -p $BACKUP_DIR

# å¤‡ä»½æ•°æ®åº“
sqlite3 $DB_FILE ".backup $BACKUP_DIR/devices_$DATE.db"

# å‹ç¼©å¤‡ä»½
gzip $BACKUP_DIR/devices_$DATE.db

# åˆ é™¤7å¤©å‰çš„å¤‡ä»½
find $BACKUP_DIR -name "devices_*.db.gz" -mtime +7 -delete

echo "Backup completed: devices_$DATE.db.gz"
```

### æ•°æ®åº“ç›‘æ§æŒ‡æ ‡

å®šæœŸæ£€æŸ¥ä»¥ä¸‹æŒ‡æ ‡ï¼š

1. **æ•°æ®é‡**: è®¾å¤‡æ•°é‡ã€è§„åˆ™æ•°é‡
2. **æŸ¥è¯¢æ€§èƒ½**: å¹³å‡æŸ¥è¯¢æ—¶é—´
3. **æ•°æ®åº“å¤§å°**: æ–‡ä»¶å¤§å°å¢é•¿è¶‹åŠ¿
4. **è¿æ¥æ•°**: å¹¶å‘è¿æ¥æ•°
5. **é”™è¯¯ç‡**: æŸ¥è¯¢å¤±è´¥ç‡

**ç›‘æ§è„šæœ¬**:

```python
# monitor_database.py
from modules.database import DatabaseManager
from modules.models import Device, Rule
import time

db_manager = DatabaseManager('sqlite:///data/devices.db')

with db_manager.session_scope() as session:
    # ç»Ÿè®¡æ•°æ®é‡
    device_count = session.query(Device).count()
    rule_count = session.query(Rule).count()
    
    # æµ‹è¯•æŸ¥è¯¢æ€§èƒ½
    start = time.time()
    devices = session.query(Device).limit(100).all()
    query_time = time.time() - start
    
    print(f"è®¾å¤‡æ•°é‡: {device_count}")
    print(f"è§„åˆ™æ•°é‡: {rule_count}")
    print(f"æŸ¥è¯¢æ—¶é—´: {query_time:.3f}ç§’")
```

## è§„åˆ™ä¼˜åŒ–æŒ‡å—

### è§„åˆ™ä¼˜åŒ–æ¦‚è¿°

è§„åˆ™ä¼˜åŒ–æ˜¯æå‡åŒ¹é…å‡†ç¡®ç‡çš„å…³é”®ç¯èŠ‚ã€‚é€šè¿‡ç³»ç»Ÿçš„è§„åˆ™ç®¡ç†ç•Œé¢ï¼Œæ‚¨å¯ä»¥å¯è§†åŒ–åœ°æŸ¥çœ‹ã€è°ƒæ•´å’Œä¼˜åŒ–åŒ¹é…è§„åˆ™ã€‚

### ä¼˜åŒ–åŸåˆ™

1. **è®¾å¤‡ç±»å‹å…³é”®è¯æƒé‡æœ€é«˜**: è®¾å¤‡ç±»å‹ï¼ˆå¦‚"æ¸©åº¦ä¼ æ„Ÿå™¨"ã€"DDCæ§åˆ¶å™¨"ï¼‰åº”è¯¥æœ‰æœ€é«˜çš„æƒé‡ï¼ˆ5.0-10.0ï¼‰
2. **å“ç‰Œå’Œå‹å·æƒé‡æ¬¡ä¹‹**: å“ç‰Œå’Œå‹å·æƒé‡å»ºè®®è®¾ç½®ä¸º 3.0
3. **é€šç”¨å‚æ•°æƒé‡æœ€ä½**: é€šç”¨å‚æ•°ï¼ˆå¦‚"4-20mA"ã€"0-10V"ï¼‰æƒé‡åº”è¯¥æœ€ä½ï¼ˆ1.0ï¼‰
4. **åŒ¹é…é˜ˆå€¼é€‚ä¸­**: å»ºè®®é˜ˆå€¼èŒƒå›´ä¸º 5.0-10.0ï¼Œé¿å…è¿‡ä½å¯¼è‡´è¯¯åŒ¹é…

### å¸¸è§é—®é¢˜è¯Šæ–­

#### é—®é¢˜ 1: ä¸åŒç±»å‹è®¾å¤‡åŒ¹é…åˆ°ç›¸åŒç»“æœ

**ç—‡çŠ¶**: è¾“å…¥"æ¸©åº¦ä¼ æ„Ÿå™¨"å’Œ"å‹åŠ›ä¼ æ„Ÿå™¨"éƒ½åŒ¹é…åˆ°åŒä¸€ä¸ªè®¾å¤‡

**åŸå› **: é€šç”¨å‚æ•°æƒé‡è¿‡é«˜ï¼Œè®¾å¤‡ç±»å‹æƒé‡ä¸è¶³

**è§£å†³æ–¹æ¡ˆ**:
1. ä½¿ç”¨è§„åˆ™ç®¡ç†ç•Œé¢æŸ¥çœ‹è§„åˆ™è¯¦æƒ…
2. é™ä½é€šç”¨å‚æ•°ï¼ˆå¦‚"4-20mA"ï¼‰æƒé‡åˆ° 1.0
3. æé«˜è®¾å¤‡ç±»å‹å…³é”®è¯æƒé‡åˆ° 5.0 æˆ–æ›´é«˜
4. ä½¿ç”¨åŒ¹é…æµ‹è¯•å·¥å…·éªŒè¯æ•ˆæœ

**æ‰¹é‡æ“ä½œ**:
```bash
# ä½¿ç”¨æ‰¹é‡æ“ä½œé™ä½æ‰€æœ‰å‚æ•°ç±»å‹çš„æƒé‡
curl -X POST "http://localhost:5000/api/rules/management/batch-update" \
  -H "Content-Type: application/json" \
  -d '{
    "operation": "update_weights_by_type",
    "feature_type": "parameter",
    "new_weight": 1.0,
    "rule_ids": []
  }'
```

#### é—®é¢˜ 2: åŒ¹é…é˜ˆå€¼è¿‡ä½å¯¼è‡´è¯¯åŒ¹é…

**ç—‡çŠ¶**: å¾ˆå¤šä¸ç›¸å…³çš„è®¾å¤‡ä¹Ÿèƒ½åŒ¹é…æˆåŠŸ

**åŸå› **: é»˜è®¤é˜ˆå€¼ 2.0 å¤ªä½ï¼Œåªéœ€ä¸€ä¸ªé€šç”¨å‚æ•°å°±èƒ½åŒ¹é…

**è§£å†³æ–¹æ¡ˆ**:
1. æŸ¥çœ‹ç»Ÿè®¡åˆ†æï¼Œç¡®è®¤é˜ˆå€¼åˆ†å¸ƒ
2. ä½¿ç”¨æ‰¹é‡æ“ä½œæé«˜æ‰€æœ‰è§„åˆ™çš„é˜ˆå€¼åˆ° 5.0
3. æˆ–ä¿®æ”¹é…ç½®æ–‡ä»¶ä¸­çš„ `default_match_threshold`

**æ‰¹é‡æ“ä½œ**:
```bash
# æ‰¹é‡æé«˜é˜ˆå€¼
curl -X POST "http://localhost:5000/api/rules/management/batch-update" \
  -H "Content-Type: application/json" \
  -d '{
    "operation": "update_threshold",
    "new_threshold": 5.0,
    "rule_ids": []
  }'
```

#### é—®é¢˜ 3: ç‰¹å®šè®¾å¤‡æ€»æ˜¯åŒ¹é…å¤±è´¥

**ç—‡çŠ¶**: æŸä¸ªè®¾å¤‡çš„æè¿°æ€»æ˜¯åŒ¹é…ä¸åˆ°æ­£ç¡®çš„è®¾å¤‡

**åŸå› **: è§„åˆ™ç‰¹å¾ä¸å¤Ÿå‡†ç¡®ï¼Œæˆ–æƒé‡åˆ†é…ä¸åˆç†

**è§£å†³æ–¹æ¡ˆ**:
1. ä½¿ç”¨åŒ¹é…æµ‹è¯•å·¥å…·æµ‹è¯•è¯¥è®¾å¤‡æè¿°
2. æŸ¥çœ‹å€™é€‰è§„åˆ™å¾—åˆ†åˆ—è¡¨ï¼Œæ‰¾å‡ºå¾—åˆ†æœ€é«˜çš„è§„åˆ™
3. æŸ¥çœ‹è§„åˆ™è¯¦æƒ…ï¼Œåˆ†æç‰¹å¾æƒé‡é…ç½®
4. æ·»åŠ ç¼ºå¤±çš„ç‰¹å¾æˆ–è°ƒæ•´æƒé‡
5. é‡æ–°æµ‹è¯•éªŒè¯æ•ˆæœ

### æƒé‡è°ƒæ•´ç­–ç•¥

#### ç­–ç•¥ 1: åŸºäºç‰¹å¾ç±»å‹çš„æƒé‡åˆ†é…

| ç‰¹å¾ç±»å‹ | å»ºè®®æƒé‡ | è¯´æ˜ |
|---------|---------|------|
| è®¾å¤‡ç±»å‹ | 5.0-10.0 | æœ€é‡è¦ï¼Œå†³å®šè®¾å¤‡å¤§ç±» |
| å“ç‰Œ | 3.0 | é‡è¦ï¼Œä½†ä¸åŒå“ç‰Œå¯èƒ½æœ‰ç›¸åŒè®¾å¤‡ |
| å‹å· | 3.0 | é‡è¦ï¼Œä½†éœ€è¦å®Œå…¨åŒ¹é… |
| å‚æ•° | 1.0-2.0 | è¾…åŠ©åˆ¤æ–­ï¼Œä½†å¾ˆå¤šè®¾å¤‡å…±äº«ç›¸åŒå‚æ•° |
| å¯é€‰ç‰¹å¾ | 0.5-1.0 | é”¦ä¸Šæ·»èŠ±ï¼Œæœ‰åˆ™åŠ åˆ† |

#### ç­–ç•¥ 2: åŸºäºç‰¹å¾åŒºåˆ†åº¦çš„æƒé‡åˆ†é…

**é«˜åŒºåˆ†åº¦ç‰¹å¾**ï¼ˆæƒé‡ 3.0-10.0ï¼‰:
- è®¾å¤‡ç±»å‹å…³é”®è¯ï¼ˆå¦‚"æ¸©åº¦ä¼ æ„Ÿå™¨"ã€"DDCæ§åˆ¶å™¨"ï¼‰
- å“ç‰Œåç§°ï¼ˆå¦‚"éœå°¼éŸ¦å°”"ã€"è¥¿é—¨å­"ï¼‰
- å‹å·ï¼ˆå¦‚"HST-RA"ã€"FX-PCV3624E"ï¼‰

**ä¸­åŒºåˆ†åº¦ç‰¹å¾**ï¼ˆæƒé‡ 1.5-2.5ï¼‰:
- ç‰¹å®šå‚æ•°èŒƒå›´ï¼ˆå¦‚"0-50â„ƒ"ã€"0-100PPM"ï¼‰
- ç‰¹æ®ŠåŠŸèƒ½ï¼ˆå¦‚"å¸¦æ˜¾ç¤º"ã€"æ— ç»§ç”µå™¨è¾“å‡º"ï¼‰

**ä½åŒºåˆ†åº¦ç‰¹å¾**ï¼ˆæƒé‡ 0.5-1.0ï¼‰:
- é€šç”¨å‚æ•°ï¼ˆå¦‚"4-20mA"ã€"0-10V"ï¼‰
- é€šç”¨æè¿°ï¼ˆå¦‚"ç®¡é“å¼å®‰è£…"ï¼‰

#### ç­–ç•¥ 3: åŸºäºåŒ¹é…æ—¥å¿—çš„åŠ¨æ€è°ƒæ•´

1. **æŸ¥çœ‹åŒ¹é…æ—¥å¿—**ï¼Œè¯†åˆ«é«˜é¢‘è¯¯åŒ¹é…ç‰¹å¾
2. **é™ä½è¯¯åŒ¹é…ç‰¹å¾çš„æƒé‡**
3. **æé«˜æ­£ç¡®åŒ¹é…ç‰¹å¾çš„æƒé‡**
4. **ä½¿ç”¨æ‰¹é‡æµ‹è¯•éªŒè¯è°ƒæ•´æ•ˆæœ**

### é˜ˆå€¼è°ƒæ•´ç­–ç•¥

#### é˜ˆå€¼è®¾ç½®åŸåˆ™

- **é˜ˆå€¼è¿‡ä½**ï¼ˆ< 3.0ï¼‰: å®¹æ˜“è¯¯åŒ¹é…ï¼Œå‡†ç¡®ç‡ä¸‹é™
- **é˜ˆå€¼é€‚ä¸­**ï¼ˆ5.0-7.0ï¼‰: å¹³è¡¡å‡†ç¡®ç‡å’Œå¬å›ç‡ï¼ˆæ¨èï¼‰
- **é˜ˆå€¼è¿‡é«˜**ï¼ˆ> 10.0ï¼‰: åŒ¹é…è¿‡äºä¸¥æ ¼ï¼Œå¾ˆå¤šè®¾å¤‡åŒ¹é…å¤±è´¥

#### åŸºäºè®¾å¤‡ç±»å‹çš„å·®å¼‚åŒ–é˜ˆå€¼

ä¸åŒç±»å‹çš„è®¾å¤‡å¯ä»¥è®¾ç½®ä¸åŒçš„é˜ˆå€¼ï¼š

| è®¾å¤‡ç±»å‹ | å»ºè®®é˜ˆå€¼ | åŸå›  |
|---------|---------|------|
| ä¼ æ„Ÿå™¨ | 5.0-7.0 | ç‰¹å¾è¾ƒå¤šï¼Œå®¹æ˜“åŒºåˆ† |
| æ§åˆ¶å™¨ | 7.0-10.0 | å‹å·å¤æ‚ï¼Œéœ€è¦æ›´ä¸¥æ ¼åŒ¹é… |
| é˜€é—¨/æ‰§è¡Œå™¨ | 5.0-7.0 | å‚æ•°ç›¸ä¼¼ï¼Œéœ€è¦é€‚ä¸­é˜ˆå€¼ |
| æ§åˆ¶æŸœ | 7.0-10.0 | é…ç½®å¤æ‚ï¼Œéœ€è¦ä¸¥æ ¼åŒ¹é… |

### ä¼˜åŒ–å·¥ä½œæµç¨‹

#### ç¬¬ä¸€æ­¥: è¯Šæ–­é—®é¢˜

1. ä½¿ç”¨åŒ¹é…æµ‹è¯•å·¥å…·æµ‹è¯•é—®é¢˜æè¿°
2. æŸ¥çœ‹å€™é€‰è§„åˆ™å¾—åˆ†åˆ—è¡¨
3. åˆ†æä¸ºä»€ä¹ˆé”™è¯¯çš„è§„åˆ™å¾—åˆ†æ›´é«˜
4. æŸ¥çœ‹åŒ¹é…æ—¥å¿—ï¼Œè¯†åˆ«é«˜é¢‘è¯¯åŒ¹é…æ¨¡å¼

#### ç¬¬äºŒæ­¥: åˆ¶å®šä¼˜åŒ–æ–¹æ¡ˆ

1. ç¡®å®šéœ€è¦è°ƒæ•´çš„ç‰¹å¾å’Œæƒé‡
2. ç¡®å®šéœ€è¦è°ƒæ•´çš„é˜ˆå€¼
3. è¯„ä¼°å½±å“èŒƒå›´ï¼ˆå¤šå°‘æ¡è§„åˆ™ä¼šå—å½±å“ï¼‰
4. å‡†å¤‡æµ‹è¯•æ•°æ®é›†éªŒè¯æ•ˆæœ

#### ç¬¬ä¸‰æ­¥: å®æ–½ä¼˜åŒ–

1. ä½¿ç”¨è§„åˆ™ç®¡ç†ç•Œé¢è°ƒæ•´å•ä¸ªè§„åˆ™
2. æˆ–ä½¿ç”¨æ‰¹é‡æ“ä½œè°ƒæ•´å¤šä¸ªè§„åˆ™
3. ä½¿ç”¨åŒ¹é…æµ‹è¯•å·¥å…·éªŒè¯å•ä¸ªæ¡ˆä¾‹
4. ä½¿ç”¨æ‰¹é‡æµ‹è¯•éªŒè¯æ•´ä½“æ•ˆæœ

#### ç¬¬å››æ­¥: éªŒè¯æ•ˆæœ

1. è¿è¡Œæ‰¹é‡æµ‹è¯•ï¼Œå¯¹æ¯”ä¼˜åŒ–å‰åçš„å‡†ç¡®ç‡
2. æŸ¥çœ‹å¤±è´¥æ¡ˆä¾‹ï¼Œåˆ†ææ˜¯å¦æœ‰æ–°çš„é—®é¢˜
3. å¦‚æœæ•ˆæœä¸ç†æƒ³ï¼Œå›æ»šåˆ°ä¹‹å‰çš„ç‰ˆæœ¬
4. å¦‚æœæ•ˆæœè‰¯å¥½ï¼Œåº”ç”¨åˆ°ç”Ÿäº§ç¯å¢ƒ

### æ‰¹é‡æ“ä½œæŒ‡å—

#### æ“ä½œ 1: æŒ‰ç‰¹å¾ç±»å‹æ‰¹é‡è°ƒæ•´æƒé‡

**åœºæ™¯**: é™ä½æ‰€æœ‰é€šç”¨å‚æ•°çš„æƒé‡

```bash
curl -X POST "http://localhost:5000/api/rules/management/batch-update" \
  -H "Content-Type: application/json" \
  -d '{
    "operation": "update_weights_by_type",
    "feature_type": "parameter",
    "new_weight": 1.0,
    "rule_ids": []
  }'
```

**å‚æ•°è¯´æ˜**:
- `feature_type`: ç‰¹å¾ç±»å‹ï¼ˆbrand/device_type/model/parameterï¼‰
- `new_weight`: æ–°çš„æƒé‡å€¼
- `rule_ids`: è§„åˆ™IDåˆ—è¡¨ï¼Œç©ºæ•°ç»„è¡¨ç¤ºåº”ç”¨åˆ°æ‰€æœ‰è§„åˆ™

#### æ“ä½œ 2: æ‰¹é‡è°ƒæ•´é˜ˆå€¼

**åœºæ™¯**: æé«˜æ‰€æœ‰è§„åˆ™çš„åŒ¹é…é˜ˆå€¼

```bash
curl -X POST "http://localhost:5000/api/rules/management/batch-update" \
  -H "Content-Type: application/json" \
  -d '{
    "operation": "update_threshold",
    "new_threshold": 5.0,
    "rule_ids": []
  }'
```

#### æ“ä½œ 3: æ‰¹é‡é‡ç½®è§„åˆ™

**åœºæ™¯**: å°†æŸäº›è§„åˆ™æ¢å¤åˆ°åˆå§‹çŠ¶æ€

```bash
curl -X POST "http://localhost:5000/api/rules/management/batch-update" \
  -H "Content-Type: application/json" \
  -d '{
    "operation": "reset_rules",
    "rule_ids": ["R_SENSOR001", "R_SENSOR002"]
  }'
```

### æµ‹è¯•éªŒè¯æŒ‡å—

#### å‡†å¤‡æµ‹è¯•æ•°æ®é›†

åˆ›å»ºæµ‹è¯•æ•°æ®é›†æ–‡ä»¶ `test_dataset.json`:

```json
{
  "dataset_id": "TEST_001",
  "name": "ä¼ æ„Ÿå™¨åŒ¹é…æµ‹è¯•é›†",
  "description": "åŒ…å«å„ç±»ä¼ æ„Ÿå™¨çš„æµ‹è¯•ç”¨ä¾‹",
  "test_cases": [
    {
      "case_id": "CASE_001",
      "input_description": "æ¸©åº¦ä¼ æ„Ÿå™¨ï¼Œ0-50â„ƒï¼Œ4-20mA",
      "expected_device_id": "SENSOR001",
      "expected_device_name": "éœå°¼éŸ¦å°” æ¸©åº¦ä¼ æ„Ÿå™¨ HST-RA",
      "category": "ä¼ æ„Ÿå™¨",
      "difficulty": "easy"
    },
    {
      "case_id": "CASE_002",
      "input_description": "å‹åŠ›ä¼ æ„Ÿå™¨ï¼Œ0-10barï¼Œ4-20mAè¾“å‡º",
      "expected_device_id": "SENSOR010",
      "expected_device_name": "è¥¿é—¨å­ å‹åŠ›ä¼ æ„Ÿå™¨ QBE2003",
      "category": "ä¼ æ„Ÿå™¨",
      "difficulty": "medium"
    }
  ]
}
```

#### è¿è¡Œæ‰¹é‡æµ‹è¯•

```bash
curl -X POST "http://localhost:5000/api/optimization/batch-test" \
  -H "Content-Type: application/json" \
  -d @test_dataset.json
```

#### æŸ¥çœ‹æµ‹è¯•æŠ¥å‘Š

```bash
curl "http://localhost:5000/api/optimization/batch-test/REPORT_001"
```

### æœ€ä½³å®è·µ

1. **å°æ­¥å¿«è·‘**: æ¯æ¬¡åªè°ƒæ•´å°‘é‡è§„åˆ™ï¼Œæµ‹è¯•éªŒè¯åå†ç»§ç»­
2. **è®°å½•å˜æ›´**: æ¯æ¬¡è°ƒæ•´éƒ½è®°å½•åŸå› å’Œæ•ˆæœï¼Œä¾¿äºå›æº¯
3. **ä¿ç•™å¤‡ä»½**: ä½¿ç”¨ç‰ˆæœ¬ç®¡ç†åŠŸèƒ½ï¼Œé‡è¦è°ƒæ•´å‰åˆ›å»ºç‰ˆæœ¬
4. **æ•°æ®é©±åŠ¨**: åŸºäºåŒ¹é…æ—¥å¿—å’Œæµ‹è¯•ç»“æœåšå†³ç­–ï¼Œä¸è¦ç›²ç›®è°ƒæ•´
5. **æŒç»­ç›‘æ§**: å®šæœŸæŸ¥çœ‹åŒ¹é…å‡†ç¡®ç‡è¶‹åŠ¿ï¼ŒåŠæ—¶å‘ç°é—®é¢˜

### å¸¸ç”¨ä¼˜åŒ–å‘½ä»¤é€ŸæŸ¥

```bash
# 1. æŸ¥çœ‹è§„åˆ™åˆ—è¡¨
curl "http://localhost:5000/api/rules/management/list?page=1&page_size=20"

# 2. æŸ¥çœ‹è§„åˆ™è¯¦æƒ…
curl "http://localhost:5000/api/rules/management/R_SENSOR001"

# 3. æ›´æ–°è§„åˆ™
curl -X PUT "http://localhost:5000/api/rules/management/R_SENSOR001" \
  -H "Content-Type: application/json" \
  -d '{"match_threshold": 5.0}'

# 4. æµ‹è¯•åŒ¹é…
curl -X POST "http://localhost:5000/api/rules/management/test" \
  -H "Content-Type: application/json" \
  -d '{"description": "æ¸©åº¦ä¼ æ„Ÿå™¨ï¼Œ0-50â„ƒï¼Œ4-20mA"}'

# 5. æŸ¥çœ‹åŒ¹é…æ—¥å¿—
curl "http://localhost:5000/api/rules/management/logs?status=failed"

# 6. æ‰¹é‡é™ä½å‚æ•°æƒé‡
curl -X POST "http://localhost:5000/api/rules/management/batch-update" \
  -H "Content-Type: application/json" \
  -d '{"operation": "update_weights_by_type", "feature_type": "parameter", "new_weight": 1.0, "rule_ids": []}'

# 7. æ‰¹é‡æé«˜é˜ˆå€¼
curl -X POST "http://localhost:5000/api/rules/management/batch-update" \
  -H "Content-Type: application/json" \
  -d '{"operation": "update_threshold", "new_threshold": 5.0, "rule_ids": []}'

# 8. æŸ¥çœ‹ç»Ÿè®¡ä¿¡æ¯
curl "http://localhost:5000/api/rules/management/statistics"
```

---

**æ–‡æ¡£ç‰ˆæœ¬**: v2.0.0  
**æœ€åæ›´æ–°**: 2026-02-12  
**ç»´æŠ¤è€…**: DDC ç³»ç»Ÿå¼€å‘å›¢é˜Ÿ
